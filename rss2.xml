<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>FJBQ</title>
    <link>http://example.com/</link>
    
    <atom:link href="http://example.com/rss2.xml" rel="self" type="application/rss+xml"/>
    
    <description>åšå®š åšæŒ åšå¼º</description>
    <pubDate>Fri, 15 Mar 2024 06:36:54 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Swift è¯­æ³•ç¬”è®°</title>
      <link>http://example.com/2024/03/13/Swift%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</link>
      <guid>http://example.com/2024/03/13/Swift%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</guid>
      <pubDate>Wed, 13 Mar 2024 05:39:24 GMT</pubDate>
      
        
        
      <description>&lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¯ä»¥å‚è€ƒèœé¸Ÿæ•™ç¨‹ï¼š&lt;br&gt;&lt;a href=&quot;https://www.runoob.com/swift/swift-tutorial.html</description>
        
      
      
      
      <content:encoded><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯ä»¥å‚è€ƒèœé¸Ÿæ•™ç¨‹ï¼š<br><a href="https://www.runoob.com/swift/swift-tutorial.html">Swift æ•™ç¨‹ | èœé¸Ÿæ•™ç¨‹ (runoob.com)</a></p><h2 id="print-å‡½æ•°"><a href="#print-å‡½æ•°" class="headerlink" title="print å‡½æ•°"></a>print å‡½æ•°</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, separator:<span class="string">&quot; . &quot;</span>, terminator:<span class="string">&quot;-&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="operator">-</span> print å‡½æ•°é»˜è®¤æ¢è¡Œï¼ˆé»˜è®¤ç»ˆç»“ç¬¦æ˜¯\nï¼‰ï¼›</span><br><span class="line"><span class="operator">-</span> separatorï¼šå®šä¹‰è¾“å‡ºçš„å†…å®¹ä¹‹é—´çš„åˆ†éš”ç¬¦ï¼›</span><br><span class="line"><span class="operator">-</span> terminatorï¼šå®šä¹‰è¾“å‡ºçš„ç»ˆç»“ç¬¦ï¼›</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span>ï¼šå®šä¹‰å˜é‡</span><br><span class="line"><span class="keyword">let</span>ï¼šå®šä¹‰å¸¸é‡</span><br></pre></td></tr></table></figure><h2 id="å­—ç¬¦ä¸²"><a href="#å­—ç¬¦ä¸²" class="headerlink" title="å­—ç¬¦ä¸²"></a>å­—ç¬¦ä¸²</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡å¤åä¸ªa</span></span><br><span class="line"><span class="keyword">var</span> s0 <span class="operator">=</span> <span class="type">String</span>(repeating: <span class="string">&quot;a&quot;</span>, count: <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šè¡Œå­—ç¬¦ä¸²</span></span><br><span class="line"><span class="keyword">var</span> s1 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä¸­å›½</span></span><br><span class="line"><span class="string">äººæ°‘</span></span><br><span class="line"><span class="string">ç«™èµ·æ¥äº†</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤šè¡Œå­—ç¬¦ä¸²(ä½†æ˜¯åªè¾“å‡ºä¸€è¡Œ)</span></span><br><span class="line"><span class="keyword">var</span> s2 <span class="operator">=</span> <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">ä¸­å›½<span class="subst">\</span></span></span><br><span class="line"><span class="subst"><span class="string"></span>äººæ°‘<span class="subst">\</span></span></span><br><span class="line"><span class="subst"><span class="string"></span>ç«™èµ·æ¥äº†</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s2)<span class="comment">// ä¸­å›½äººæ°‘ç«™èµ·æ¥äº†</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è½¬ä¹‰å­—ç¬¦\</span></span><br><span class="line"><span class="keyword">var</span> s3 <span class="operator">=</span> <span class="string">&quot;<span class="subst">\&quot;</span>ä¸­å›½<span class="subst">\&quot;</span>&quot;</span></span><br><span class="line"><span class="built_in">print</span>(s3)<span class="comment">// è¾“å‡ºï¼šâ€œä¸­å›½â€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å®šç•Œç¬¦ï¼ˆä¸ç”¨è½¬ä¹‰ï¼‰</span></span><br><span class="line"><span class="keyword">var</span> s4 <span class="operator">=</span> <span class="string">#&quot;&quot;ä¸­&#x27;å›½&quot;&quot;#</span></span><br><span class="line"><span class="built_in">print</span>(s3)<span class="comment">// è¾“å‡ºï¼š&quot;ä¸­&#x27;å›½&quot;ï¼ˆç¬¬ä¸€å¯¹ &quot;&quot; è¡¨ç¤ºå­—ç¬¦ä¸²çš„æ„æ€ï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²é“¾æ¥</span></span><br><span class="line"><span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;fj&quot;</span></span><br><span class="line"><span class="keyword">var</span> age <span class="operator">=</span> <span class="number">22</span></span><br><span class="line"><span class="keyword">var</span> hello <span class="operator">=</span> <span class="string">&quot;bq&quot;</span></span><br><span class="line"><span class="keyword">var</span> s5 <span class="operator">=</span> name <span class="operator">+</span> hello       <span class="comment">// s5   = fjbq</span></span><br><span class="line">name.append(hello)          <span class="comment">// name = fjbq</span></span><br><span class="line">name <span class="operator">+=</span> hello               <span class="comment">// name = fjbqbq</span></span><br><span class="line"><span class="keyword">var</span> s7 <span class="operator">=</span> <span class="string">&quot;<span class="subst">\(name)</span> å¹´é¾„æ˜¯: <span class="subst">\(age)</span>å²&quot;</span>   <span class="comment">// å­—ç¬¦ä¸²è½¬ä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;s5 : &quot;</span> <span class="operator">+</span> s5)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;s7 : &quot;</span> <span class="operator">+</span> s7)</span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²å±æ€§</span></span><br><span class="line"><span class="keyword">var</span> name <span class="operator">=</span> <span class="string">&quot;Fj Qq&quot;</span></span><br><span class="line"><span class="built_in">print</span>(name.isEmpty)</span><br><span class="line"><span class="built_in">print</span>(name.count)               <span class="comment">// è¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦</span></span><br><span class="line"><span class="built_in">print</span>(name.description)         <span class="comment">// è¾“å‡ºå­—ç¬¦ä¸²çš„å€¼</span></span><br><span class="line"><span class="built_in">print</span>(name.debugDescription)    <span class="comment">// ä¾¿äºè°ƒè¯•çš„å€¼</span></span><br><span class="line"><span class="built_in">print</span>(name.hashValue)           <span class="comment">// è¾“å‡ºå“ˆå¸Œå€¼(æ¯ä¸€ä¸ªå˜é‡éƒ½æœ‰ä¸€ä¸ªhashå€¼)</span></span><br><span class="line"><span class="built_in">print</span>(name.uppercased())        <span class="comment">// å¤§å†™</span></span><br><span class="line"><span class="built_in">print</span>(name.lowercased())        <span class="comment">// å°å†™</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;proNum&quot;</span>.hasPrefix(<span class="string">&quot;pro&quot;</span>))    <span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰proå‰ç¼€</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;proNum&quot;</span>.hasPrefix(<span class="string">&quot;Num&quot;</span>))    <span class="comment">// åˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰Numåç¼€</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å­—ç¬¦ä¸²éå†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> ss <span class="operator">=</span> <span class="string">&quot;fjbqä¸­å›½äººğŸ‘€&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//  ç›´æ¥éå†å€¼</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> ss &#123;</span><br><span class="line">    <span class="built_in">print</span>(c)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éå†ç´¢å¼•(ç´¢å¼•ä¸æ˜¯012...)</span></span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> ss.indices &#123;</span><br><span class="line">    <span class="built_in">print</span>(ss[index])    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ss.startIndex æ˜¯ ss çš„ç¬¬ä¸€ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="built_in">print</span>(ss[ss.startIndex])                    </span><br><span class="line"></span><br><span class="line"><span class="comment">// ss.endIndex æ˜¯ssçš„æœ€åä¸€ä¸ªç´¢å¼•ï¼ˆä½†æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªå­—ç¬¦ï¼Œæ˜¯æœ€åä¸€ä¸ªå­—ç¬¦çš„ä¸‹ä¸€ä¸ªä½ç½®ï¼‰</span></span><br><span class="line"><span class="comment">// ss.index() è¡¨ç¤ºå¯¹ssçš„ç´¢å¼•è¿›è¡Œæ“ä½œï¼š</span></span><br><span class="line"><span class="comment">// ss.index(before: ss.endIndex) è¡¨ç¤ºè·å– ss.endIndex ç´¢å¼•çš„å‰ä¸€ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="comment">// ss.index(after: ss.endIndex) è¡¨ç¤ºè·å– ss.endIndex ç´¢å¼•çš„åä¸€ä¸ªç´¢å¼•</span></span><br><span class="line"><span class="comment">// ss.index(ss.endIndex, offsetBy: -2) è¡¨ç¤ºè·å– ss.endIndex ç´¢å¼•åç§» -2 çš„ç´¢å¼•</span></span><br><span class="line"><span class="built_in">print</span>(ss[ss.index(before: ss.endIndex)])    </span><br></pre></td></tr></table></figure><h2 id="æ•´æ•°ã€æµ®ç‚¹æ•°ã€åŒç²¾åº¦"><a href="#æ•´æ•°ã€æµ®ç‚¹æ•°ã€åŒç²¾åº¦" class="headerlink" title="æ•´æ•°ã€æµ®ç‚¹æ•°ã€åŒç²¾åº¦"></a>æ•´æ•°ã€æµ®ç‚¹æ•°ã€åŒç²¾åº¦</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">æ•´æ•°<span class="operator">ã€</span>æµ®ç‚¹æ•°<span class="operator">ã€</span>åŒç²¾åº¦</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> <span class="number">4.0</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">type</span>(of: a))<span class="comment">// double</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> myAge:<span class="type">Int</span> <span class="operator">=</span> <span class="number">50</span><span class="comment">// æ˜¾ç¤ºå£°æ˜æ•´æ•°</span></span><br><span class="line"><span class="keyword">var</span> yourAge <span class="operator">=</span> <span class="type">Int</span>(<span class="number">60.0</span>)<span class="comment">// doubleè½¬æ¢ä¸ºint</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> <span class="number">0b10</span><span class="comment">// 2è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> <span class="number">0o7</span><span class="comment">// 8è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> c <span class="operator">=</span> <span class="number">0xf</span><span class="comment">// 16è¿›åˆ¶</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> d <span class="operator">=</span> <span class="number">89_000_000</span><span class="comment">// åˆ†å‰²æ•°å­—</span></span><br><span class="line"><span class="built_in">print</span>(d)<span class="comment">// 89000000</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> price <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;3&quot;</span>) <span class="operator">??</span> <span class="number">0</span><span class="comment">// ?? è¿ç®—ç¬¦ï¼šInt(&quot;3&quot;) æˆåŠŸåˆ™ä¸º3ï¼Œä¸æˆåŠŸåˆ™ä¸º 0ï¼ˆä¸åŠ ï¼Ÿï¼Ÿä¼šæŠ¥é”™ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(price)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŒ‡å®šè½¬æ¢çš„è¿›åˆ¶</span></span><br><span class="line"><span class="keyword">var</span> price1 <span class="operator">=</span> <span class="type">Int</span>(<span class="string">&quot;ff&quot;</span>, radix: <span class="number">16</span>) <span class="operator">??</span> <span class="number">0</span></span><br><span class="line"><span class="built_in">print</span>(price1)</span><br><span class="line"></span><br><span class="line"><span class="comment">// éšæœºæ•°</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.random(in: <span class="number">1</span><span class="operator">...</span><span class="number">100</span>))<span class="comment">// [1,100]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.random(in: <span class="number">100</span><span class="operator">..&lt;</span><span class="number">110</span>))<span class="comment">// [100,110)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="operator">-</span><span class="number">21</span></span><br><span class="line">x.negate()<span class="comment">// -21 å˜æˆ 21</span></span><br><span class="line"></span><br><span class="line">x <span class="operator">=</span> <span class="operator">-</span><span class="number">30</span></span><br><span class="line"><span class="built_in">print</span>(x.magnitude)<span class="comment">// magnitude ç»å¯¹å€¼å±æ€§</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// quotientAndRemainderï¼šæ±‚å•†å’Œä½™æ•°ï¼›dividingByï¼šé™¤ä»¥</span></span><br><span class="line">x <span class="operator">=</span> <span class="number">100</span></span><br><span class="line"><span class="keyword">let</span> (q,r) <span class="operator">=</span> quotientAndRemainder(dividingBy: <span class="number">9</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿”å›xçš„ç¬¦å·ï¼š-1ï¼Œ0ï¼Œ1</span></span><br><span class="line"><span class="built_in">print</span>(x.signum())</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•´æ•°çš„å¸¸é‡</span></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.zero)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.max)</span><br><span class="line"><span class="built_in">print</span>(<span class="type">Int</span>.min)</span><br><span class="line"></span><br><span class="line"><span class="operator">-------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">åŒç²¾åº¦</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> z1 <span class="operator">=</span> <span class="type">Double</span>.random(in: <span class="number">10.0</span><span class="operator">...</span><span class="number">100.0</span>)</span><br><span class="line"><span class="built_in">print</span>(z1.squareRoot())<span class="comment">// å¹³æ–¹æ ¹</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‘ä¼¼å€¼</span></span><br><span class="line">x <span class="operator">=</span> <span class="number">100.23</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded())<span class="comment">// é»˜è®¤å››èˆäº”å…¥</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.awayFromZero))<span class="comment">// å››èˆäº”å…¥åˆ°å¹…åº¦å¤§äºæˆ–ç­‰äºæºå€¼çš„æœ€æ¥è¿‘çš„å…è®¸å€¼</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.down))<span class="comment">// å››èˆäº”å…¥ä¸ºå°äºæˆ–ç­‰äºæºå€¼çš„æœ€æ¥è¿‘çš„å…è®¸å€¼</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.toNearestOrAwayFromZero))<span class="comment">// å››èˆäº”å…¥åˆ°æœ€æ¥è¿‘çš„å…è®¸å€¼ï¼›å¦‚æœä¸¤ä¸ªå€¼åŒæ ·æ¥è¿‘ï¼Œåˆ™é€‰æ‹©å¹…åº¦è¾ƒå¤§çš„ä¸€ä¸ª</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.toNearestOrEven))<span class="comment">// å››èˆäº”å…¥åˆ°æœ€æ¥è¿‘çš„å…è®¸å€¼ï¼›å¦‚æœä¸¤ä¸ªå€¼åŒæ ·æ¥è¿‘ï¼Œåˆ™é€‰æ‹©å¶æ•°</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.towardZero))<span class="comment">// å››èˆäº”å…¥åˆ°å¹…åº¦å°äºæˆ–ç­‰äºæºå€¼çš„æœ€æ¥è¿‘çš„å…è®¸å€¼</span></span><br><span class="line"><span class="built_in">print</span>(x.rounded(.up))<span class="comment">// å››èˆäº”å…¥ä¸ºå¤§äºæˆ–ç­‰äºæºå€¼çš„æœ€æ¥è¿‘çš„å…è®¸å€¼</span></span><br><span class="line"></span><br><span class="line">y <span class="operator">=</span> <span class="operator">-</span><span class="number">1.1</span></span><br><span class="line"><span class="built_in">print</span>(y.magnitude)<span class="comment">// ç»å¯¹å€¼</span></span><br><span class="line"><span class="built_in">print</span>(y.sign)<span class="comment">// ç¬¦å·ï¼šplusï¼Œminus</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Double</span>.pi)<span class="comment">// å¸¸é‡</span></span><br><span class="line"></span><br><span class="line"><span class="operator">------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line">å¸ƒå°”å€¼</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> x <span class="operator">=</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">var</span> y:<span class="type">Bool</span> <span class="operator">=</span> <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">x.toggle()<span class="comment">// x å–å</span></span><br><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="type">Bool</span>.random())<span class="comment">// éšæœºå¸ƒå°”å€¼</span></span><br></pre></td></tr></table></figure><h2 id="è¿ç®—ç¬¦"><a href="#è¿ç®—ç¬¦" class="headerlink" title="è¿ç®—ç¬¦"></a>è¿ç®—ç¬¦</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">è¿ç®—ç¬¦</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (a, b) <span class="operator">=</span> (<span class="number">10</span>,<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç©ºåˆè¿ç®—ç¬¦</span></span><br><span class="line"><span class="keyword">var</span> h:<span class="type">String</span>?<span class="comment">// è¡¨ç¤ºå¯èƒ½æ²¡æœ‰å€¼</span></span><br><span class="line"><span class="built_in">print</span>(h <span class="operator">??</span> <span class="string">&quot;&quot;</span>)<span class="comment">// æœ‰å€¼è¾“å‡ºhï¼Œæ²¡å€¼è¾“å‡º&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åŒºé—´è¿ç®—ç¬¦</span></span><br><span class="line"><span class="comment">// 1...10[1,10]</span></span><br><span class="line"><span class="comment">// 1..&lt;10[1,10)</span></span><br><span class="line"><span class="comment">// ä¸‹é¢ä¸¤ä¸ªåªèƒ½åœ¨æœ‰åŒºé—´é™åˆ¶çš„æƒ…å†µä¸‹ä½¿ç”¨</span></span><br><span class="line"><span class="comment">// ...10[0,10]</span></span><br><span class="line"><span class="comment">// ..&lt;10[0,10)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–çš„åŸºæœ¬å’ŒC++ä¸€æ ·</span></span><br></pre></td></tr></table></figure><h2 id="å°ç»ƒä¹ ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯"><a href="#å°ç»ƒä¹ ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯" class="headerlink" title="å°ç»ƒä¹ ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯"></a>å°ç»ƒä¹ ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">å°ç»ƒä¹ ï¼šè®¡ç®—åœ†çš„å‘¨é•¿å’Œé¢ç§¯</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;è¯·è¾“å…¥åœ†çš„åŠå¾„ï¼š&quot;</span>, terminator: <span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="keyword">var</span> value <span class="operator">=</span> <span class="built_in">readLine</span>() <span class="operator">??</span> <span class="string">&quot;0.0&quot;</span>     <span class="comment">// è¯»å…¥çš„æ˜¯å­—ç¬¦ä¸²ï¼Œå¯èƒ½ä¸è¯»å…¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> radius:<span class="type">Double</span> <span class="operator">=</span> <span class="number">0.0</span></span><br><span class="line">radius <span class="operator">=</span> <span class="type">Double</span>(value) <span class="operator">??</span> <span class="number">0.0</span>       <span class="comment">// å¯èƒ½è½¬åŒ–å¤±è´¥</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> area <span class="operator">=</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius <span class="operator">*</span> radius</span><br><span class="line"><span class="keyword">let</span> perimeter <span class="operator">=</span> <span class="number">2</span> <span class="operator">*</span> <span class="type">Double</span>.pi <span class="operator">*</span> radius</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;åŠå¾„ä¸º <span class="subst">\(radius)</span> çš„åœ†<span class="subst">\n</span>å‘¨é•¿æ˜¯ <span class="subst">\(perimeter.rounded())</span>  <span class="subst">\n</span>é¢ç§¯æ˜¯ <span class="subst">\(area.rounded())</span>&quot;</span>)</span><br></pre></td></tr></table></figure><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line">æ•°ç»„</span><br><span class="line"></span><br><span class="line">æ€§è´¨ï¼š</span><br><span class="line"><span class="number">1</span>. æœ‰åº</span><br><span class="line"><span class="number">2</span>. ç±»å‹ç»Ÿä¸€</span><br><span class="line"><span class="number">3</span>. å†…å®¹å¯é‡å¤</span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„çš„å£°æ˜å’Œå®šä¹‰</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a <span class="operator">=</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> b <span class="operator">=</span> [<span class="string">&quot;a&quot;</span>,<span class="string">&quot;b&quot;</span>,<span class="string">&quot;c&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> c <span class="operator">=</span> [<span class="literal">true</span>,<span class="literal">false</span>,<span class="literal">true</span>]</span><br><span class="line"><span class="built_in">print</span>(a,b,c)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> a1:<span class="type">Array</span>&lt;<span class="type">Int</span>&gt; <span class="operator">=</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line"><span class="keyword">var</span> a2:[<span class="type">Int</span>] <span class="operator">=</span> [<span class="number">1</span>,<span class="number">2</span>]</span><br><span class="line"><span class="built_in">print</span>(a1,a2)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> b1 <span class="operator">=</span> <span class="type">Array</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> b2 <span class="operator">=</span> <span class="type">Array</span>&lt;<span class="type">Int</span>&gt;([<span class="number">1</span>,<span class="number">2</span>])</span><br><span class="line"><span class="keyword">var</span> b3 <span class="operator">=</span> <span class="type">Array</span>(<span class="number">1</span><span class="operator">...</span><span class="number">7</span>)</span><br><span class="line"><span class="built_in">print</span>(b1,b2,b3)</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> c1 <span class="operator">=</span> <span class="type">Array</span>(repeating:<span class="string">&quot;*&quot;</span>, count:<span class="number">6</span>)</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c1.count)     <span class="comment">// ç»Ÿè®¡å…ƒç´ çš„ä¸ªæ•°</span></span><br><span class="line"><span class="built_in">print</span>(c1.isEmpty)   <span class="comment">// åˆ¤æ–­æ˜¯å¦ä¸ºç©º</span></span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‹æ ‡è®¿é—®æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a[<span class="number">0</span>])         <span class="comment">// è¾“å‡ºï¼š1</span></span><br><span class="line"><span class="built_in">print</span>(b[<span class="number">0</span><span class="operator">...</span><span class="number">2</span>])     <span class="comment">// è¾“å‡ºï¼š[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span></span><br><span class="line"><span class="built_in">print</span>(b[<span class="operator">...</span><span class="number">2</span>])      <span class="comment">// è¾“å‡ºï¼š[&quot;a&quot;, &quot;b&quot;, &quot;c&quot;]</span></span><br><span class="line"><span class="built_in">print</span>(b[<span class="number">1</span><span class="operator">...</span>])      <span class="comment">// è¾“å‡ºï¼š[&quot;b&quot;, &quot;c&quot;, &quot;d&quot;, &quot;e&quot;]</span></span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„çš„éå†</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> b</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(item, terminator: <span class="string">&quot;-&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;</span>)</span><br><span class="line"><span class="comment">// è¾“å‡ºï¼ša-b-c-d-e-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (i, value) <span class="keyword">in</span> b.enumerated()</span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">print</span>(i, value, separator: <span class="string">&quot;:&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">è¾“å‡ºï¼š</span></span><br><span class="line"><span class="comment">0:a</span></span><br><span class="line"><span class="comment">1:b</span></span><br><span class="line"><span class="comment">2:c</span></span><br><span class="line"><span class="comment">3:d</span></span><br><span class="line"><span class="comment">4:e</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(b[b.count <span class="operator">-</span> <span class="number">1</span>])   <span class="comment">// è¾“å‡ºæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ ï¼Œæ•°ç»„ä¸ºç©ºä¼šæŠ¥é”™</span></span><br><span class="line"><span class="built_in">print</span>(b.first <span class="operator">??</span> <span class="string">&quot;&quot;</span>)    <span class="comment">// è¾“å‡ºæ•°ç»„çš„ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œæ²¡åŠ  ?? &quot;&quot; ä¼šè¾“å‡º Optional(&quot;a&quot;)ï¼Œè¡¨ç¤ºè¿™ä¸ªå€¼æ˜¯å¯é€‰çš„ï¼ˆå¯èƒ½ä¸ºç©ºï¼‰ï¼Œå½“æ•°ç»„ä¸ºç©ºæ—¶è¾“å‡ºnil</span></span><br><span class="line"><span class="built_in">print</span>(b.last <span class="operator">??</span> <span class="string">&quot;&quot;</span>)     <span class="comment">// è¾“å‡ºæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span>(b.randomElement() <span class="operator">??</span> <span class="string">&quot;&quot;</span>)  <span class="comment">// éšæœºä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„ è¿½åŠ å…ƒç´ </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> v <span class="operator">=</span> [<span class="string">&quot;åšå®š&quot;</span>, <span class="string">&quot;åšæŒ&quot;</span>, <span class="string">&quot;åšå¼º&quot;</span>]</span><br><span class="line">v.append(<span class="string">&quot;åŠªåŠ›&quot;</span>)    <span class="comment">// è¿½åŠ ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line"></span><br><span class="line">v.append(contentsOf: [<span class="string">&quot;å‹‡æ•¢&quot;</span>,<span class="string">&quot;ä¹è§‚&quot;</span>])</span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line"></span><br><span class="line">v <span class="operator">+=</span> [<span class="string">&quot;å¥‹æ–—&quot;</span>,<span class="string">&quot;å¹¸è¿&quot;</span>]</span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line"></span><br><span class="line"><span class="operator">--------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„ æ’å…¥å’Œæ›¿æ¢</span></span><br><span class="line">v.insert(<span class="string">&quot;fjbq&quot;</span>, at: <span class="number">0</span>)                         <span class="comment">// å°†fjbqæ’å…¥åˆ°ç¬¬0çš„ä½ç½®</span></span><br><span class="line">v.insert(contentsOf:[<span class="string">&quot;fj&quot;</span>,<span class="string">&quot;fj777&quot;</span>], at: <span class="number">0</span>)      <span class="comment">// æ’å…¥æ•°ç»„</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> v1 <span class="operator">=</span> <span class="type">Array</span>&lt;<span class="type">Int</span>&gt;()</span><br><span class="line">v1.insert(contentsOf: <span class="number">1</span><span class="operator">...</span><span class="number">3</span>, at: <span class="number">0</span>)              <span class="comment">// æ’å…¥åºåˆ—</span></span><br><span class="line"><span class="built_in">print</span>(v1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line">v.replaceSubrange(<span class="number">0</span><span class="operator">...</span><span class="number">2</span>, with:[<span class="string">&quot;1&quot;</span>,<span class="string">&quot;2&quot;</span>])    <span class="comment">// å°†væ•°ç»„çš„0-2çš„å…ƒç´ æ›¿æ¢æˆåé¢çš„æ•°ç»„ï¼ˆä¸ªæ•°å¯ä»¥ä¸åŒ¹é…ï¼‰</span></span><br><span class="line"><span class="built_in">print</span>(v)</span><br><span class="line"></span><br><span class="line"><span class="operator">----------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•°ç»„çš„åˆ é™¤å’ŒæŸ¥æ‰¾</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> v2 <span class="operator">=</span> [<span class="string">&quot;111&quot;</span>,<span class="string">&quot;222&quot;</span>,<span class="string">&quot;333&quot;</span>,<span class="string">&quot;444&quot;</span>,<span class="string">&quot;111&quot;</span>]</span><br><span class="line"><span class="keyword">var</span> v3 <span class="operator">=</span> <span class="type">Array</span>&lt;<span class="type">String</span>&gt;()</span><br><span class="line"><span class="keyword">var</span> v4 <span class="operator">=</span> [<span class="number">111</span>,<span class="number">222</span>,<span class="number">333</span>,<span class="number">444</span>,<span class="number">111</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">// v2.remove(at: 1)            // åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Œä¸‹æ ‡è¶Šç•Œä¼šæŠ¥é”™ï¼Œç©ºæ•°ç»„ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// v2.removeFirst()            // åˆ é™¤ç¬¬ä¸€ä¸ªå…ƒç´ ï¼Œç©ºæ•°ç»„ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// v2.removeLast()             // åˆ é™¤æœ€åä¸€ä¸ªå…ƒç´ ï¼Œç©ºæ•°ç»„ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// v2.removeSubrange(1...2)    // åˆ é™¤ä¸€ä¸ªå­åŒºé—´ï¼Œä¸‹æ ‡è¶Šç•Œä¼šæŠ¥é”™ï¼Œç©ºæ•°ç»„ä¼šæŠ¥é”™</span></span><br><span class="line"><span class="comment">// v2.removeAll()              // å…¨éƒ¨åˆ é™¤</span></span><br><span class="line"><span class="comment">// print(v2)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> flag <span class="operator">=</span> v2.contains(<span class="string">&quot;111&quot;</span>)   <span class="comment">// æŸ¥æ‰¾æ•°ç»„v2é‡Œé¢æ˜¯å¦åŒ…å«&quot;111&quot;ï¼Œè¿”å›å¸ƒå°”å€¼</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ–¹æ³•ä¸€ï¼š</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    v2.first(where: &#123; &#125;)ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">    where: &#123;$0 == &quot;222&quot;&#125; è¿™æ˜¯ä¸€ä¸ªæ¡ä»¶ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªé—­åŒ…</span></span><br><span class="line"><span class="comment">    $0 è¡¨ç¤ºé—­åŒ…ä¸­çš„éšå¼å‚æ•°</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> value <span class="operator">=</span> v2.first(where: &#123;<span class="variable">$0</span> <span class="operator">==</span> <span class="string">&quot;222&quot;</span>&#125;)</span><br><span class="line"><span class="built_in">print</span>(value <span class="operator">??</span> <span class="string">&quot;&quot;</span>)  <span class="comment">// è¾“å‡ºï¼š222ï¼ˆåŠ ?? &quot;&quot;çš„åŸå› æ˜¯å¯èƒ½æ‰¾ä¸åˆ°ï¼Œæ‰¾ä¸åˆ°ä¸ºnilï¼‰</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">æ–¹æ³•äºŒï¼š</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    v2.firstIndex(where: &#123; &#125;)ï¼šæ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ çš„ä¸‹æ ‡</span></span><br><span class="line"><span class="comment">    n ä¹Ÿæ˜¯ç›¸å½“äºæ˜¯éšå¼å‚æ•°</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">        è¿™é‡Œçš„ç»“æœä¸èƒ½ç›´æ¥ç”¨ä¸Šé¢çš„ value æ‰¿æ¥ï¼›</span></span><br><span class="line"><span class="comment">        å› ä¸º swift å®é™…ä¸Šæ˜¯ å¼ºæ•°æ®ç±»å‹ çš„è¯­è¨€ï¼Œä¸åƒ lua æ˜¯å¼±æ•°æ®ç±»å‹çš„è¯­è¨€</span></span><br><span class="line"><span class="comment">        value åœ¨ä¸Šé¢å·²ç»è¢«ç”¨ä½œ String äº†ï¼Œä¸‹é¢å†ç»™ä»–èµ‹å€¼ä¸º Int å°±ä¸è¡Œï¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">var</span> value1 <span class="operator">=</span> v2.firstIndex(where: &#123;n <span class="keyword">in</span></span><br><span class="line">    n <span class="operator">==</span> <span class="string">&quot;333&quot;</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">print</span>(value1) <span class="comment">// è¾“å‡ºï¼šOptional(2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">å…¶ä»–ï¼š</span></span><br><span class="line"><span class="comment">    .first æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ </span></span><br><span class="line"><span class="comment">    .firstIndex æ‰¾åˆ°ç¬¬ä¸€ä¸ªæ»¡è¶³æ¡ä»¶çš„å…ƒç´ çš„ç´¢å¼•å·</span></span><br><span class="line"><span class="comment">    .last æœ€åä¸€ä¸ªå…ƒç´ </span></span><br><span class="line"><span class="comment">    .lastIndex æœ€åä¸€ä¸ªå…ƒç´ ç´¢å¼•</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="operator">----------------------------------------------------------------------------------------</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Swift/">Swift</category>
      
      <category domain="http://example.com/categories/Swift/%E5%AE%A2%E6%88%B7%E7%AB%AF/">å®¢æˆ·ç«¯</category>
      
      
      <category domain="http://example.com/tags/Swift/">Swift</category>
      
      <category domain="http://example.com/tags/%E5%AE%A2%E6%88%B7%E7%AB%AF/">å®¢æˆ·ç«¯</category>
      
      
      <comments>http://example.com/2024/03/13/Swift%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 7ï¼šè·¯å¾„è¿½è¸ª</title>
      <link>http://example.com/2024/01/29/games101/HomeWork%207/</link>
      <guid>http://example.com/2024/01/29/games101/HomeWork%207/</guid>
      <pubDate>Mon, 29 Jan 2024 13:54:27 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-7ï¼šè·¯å¾„è¿½è¸ª&quot;&gt;&lt;a href=&quot;#HomeWork-7ï¼šè·¯å¾„è¿½è¸ª&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 7ï¼šè·¯å¾„è¿½è¸ª&quot;&gt;&lt;/a&gt;HomeWork 7ï¼šè·¯å¾„è¿½è¸ª&lt;/h1&gt;&lt;p&gt;é¦–å…ˆæŒ‰ç…§ pdf é‡Œé¢çš„æ“ä½œï¼Œå°†ç›¸å…³</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-7ï¼šè·¯å¾„è¿½è¸ª"><a href="#HomeWork-7ï¼šè·¯å¾„è¿½è¸ª" class="headerlink" title="HomeWork 7ï¼šè·¯å¾„è¿½è¸ª"></a>HomeWork 7ï¼šè·¯å¾„è¿½è¸ª</h1><p>é¦–å…ˆæŒ‰ç…§ pdf é‡Œé¢çš„æ“ä½œï¼Œå°†ç›¸å…³å‡½æ•°è¿ç§»è¿‡æ¥ï¼›</p><p>IntersectP å‡½æ•°æœ€ååˆ¤æ–­çš„æ—¶å€™ï¼Œéœ€è¦&#x3D;ï¼Œä¸ç„¶å¯èƒ½ä¼šæœ‰é—®é¢˜ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bounds3::IntersectP</span><span class="params">(<span class="type">const</span> Ray&amp; ray, <span class="type">const</span> Vector3f&amp; invDir, <span class="type">const</span> std::array&lt;<span class="type">int</span>, <span class="number">3</span>&gt;&amp; dirIsNeg)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">...</span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œéœ€è¦ = ï¼Œä¸ç„¶å¥½åƒä¼šå‡ºé—®é¢˜</span></span><br><span class="line">    <span class="keyword">return</span> t_exit &gt;= <span class="number">0.0f</span> &amp;&amp; t_enter &lt;= t_exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åå°±æ˜¯æœ¬æ¬¡ä½œä¸šçš„å†…å®¹ï¼Œæœ¬æ¬¡ä½œä¸šè¦å®ç°çš„æ˜¯è·¯å¾„è¿½è¸ªå‡½æ•°ï¼›</p><p>  è¿™ä¸ªä½œä¸šæ˜¯çœŸçš„æœ‰ç‚¹éš¾â€¦ ä¸»è¦æ˜¯çŸ¥è¯†ç‚¹éƒ½å¿˜äº†â€¦ </p><p>  å»ºè®®å›å»çœ‹ä¸€éè§†é¢‘â€¦ ç„¶åå¯¹ç…§è¯¾ç¨‹ä¸­çš„ä¼ªä»£ç ä¸€æ­¥ä¸€æ­¥æ¯”å¯¹å®ç°</p><p>  castRay è¿™ä¸ªå‡½æ•°å®ç°çš„å°±æ˜¯è·¯å¾„è¿½è¸ª</p><p>  å…·ä½“ç»†èŠ‚çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šï¼</p><p>çŸ¥è¯†ç‚¹å‚è€ƒçš„æ˜¯è¿™ä¸€èŠ‚è¯¾çš„å†…å®¹ï¼š</p><p><a href="https://fjbq-blog.top/2024/01/13/games101/Lec%2016/">ã€Games 101ã€‘Lec 16ï¼šå…‰çº¿è¿½è¸ª 4ï¼ˆè’™ç‰¹å¡ç½—ç§¯åˆ†ï¼Œè·¯å¾„è¿½è¸ªï¼‰</a></p><p><strong>Scene.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªä½œä¸šæ˜¯çœŸçš„æœ‰ç‚¹éš¾... ä¸»è¦æ˜¯çŸ¥è¯†ç‚¹éƒ½å¿˜äº†... </span></span><br><span class="line"><span class="comment">    å»ºè®®å›å»çœ‹ä¸€éè§†é¢‘... ç„¶åå¯¹ç…§è¯¾ç¨‹ä¸­çš„ä¼ªä»£ç ä¸€æ­¥ä¸€æ­¥æ¯”å¯¹å®ç°</span></span><br><span class="line"><span class="comment">    castRay è¿™ä¸ªå‡½æ•°å®ç°çš„å°±æ˜¯è·¯å¾„è¿½è¸ª</span></span><br><span class="line"><span class="comment">    å…·ä½“ç»†èŠ‚çœ‹ä»£ç é‡Œé¢çš„æ³¨é‡Šï¼</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Vector3f <span class="title">Scene::castRay</span><span class="params">(<span class="type">const</span> Ray &amp;ray, <span class="type">int</span> depth)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// é¦–å…ˆï¼Œè·å¾—å…‰çº¿ç¬¬ä¸€ä¸ªæ‰“åˆ°çš„ç‚¹ï¼ˆä¸‹é¢å«åšç€è‰²ç‚¹å§ï¼‰</span></span><br><span class="line">    Intersection p = <span class="built_in">intersect</span>(ray);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ²¡æ‰“åˆ°ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span>(!p.happened) <span class="keyword">return</span> <span class="built_in">Vector3f</span>(<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å¦‚æœç€è‰²ç‚¹è‡ªå·±æ˜¯å…‰æºï¼Œåˆ™ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span>(p.m-&gt;<span class="built_in">hasEmission</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> p.m-&gt;<span class="built_in">getEmission</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        å¦åˆ™ï¼Œå¦‚æœè¯¥ç€è‰²ç‚¹æ˜¯éå…‰æºï¼ŒæŒ‰ç…§è¯¾ç¨‹è®²çš„ï¼Œåˆ™åˆ†ä¸ºä¸¤éƒ¨åˆ†æ¥æ±‚ï¼š</span></span><br><span class="line"><span class="comment">        1. å…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®ï¼ˆç›´æ¥å¯¹å…‰æºå–æ ·ï¼Œä¸ç”¨RRï¼‰</span></span><br><span class="line"><span class="comment">        2. å…¶ä»–éå…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®ï¼ˆé€’å½’æ±‚è§£ï¼Œç”¨RRï¼‰</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…‰çº¿çš„æ–¹å‘</span></span><br><span class="line">    Vector3f wo = ray.direction;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå°±æ˜¯ç¬¬ 1 é¡¹ï¼Œå…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®</span></span><br><span class="line">    <span class="function">Vector3f <span class="title">L_indir</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªå°±æ˜¯ç¬¬ 2 é¡¹ï¼Œå…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®</span></span><br><span class="line">    <span class="function">Vector3f <span class="title">L_dir</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*----------------- 1. å…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®ï¼ˆç›´æ¥å¯¹å…‰æºå–æ ·ï¼Œä¸ç”¨RRï¼‰---------------*/</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹å…‰æºè¿›è¡Œå–æ ·ï¼Œå¾—åˆ°å…‰æºçš„ pdf å’Œ å…‰æºä¸Šçš„ç‚¹ å’Œ å…‰æºçš„é¢ç§¯å¯†åº¦pdf</span></span><br><span class="line">    Intersection inter_l;       <span class="comment">// åœ¨å…‰æºä¸Šçš„äº¤ç‚¹</span></span><br><span class="line">    <span class="type">float</span> pdf_light;                  <span class="comment">// å…‰æºçš„ pdf</span></span><br><span class="line">    <span class="built_in">sampleLight</span>(inter_l, pdf_light);</span><br><span class="line">    Vector3f x = inter_l.coords;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—ç€è‰²ç‚¹påˆ°å…‰æºï¼ˆé‡‡æ ·ç‚¹ï¼‰çš„ æ–¹å‘ ä¸ è·ç¦»</span></span><br><span class="line">    <span class="type">float</span> p2lightDist = (x - p.coords).<span class="built_in">norm</span>();</span><br><span class="line">    Vector3f p2lightDir = (x - p.coords).<span class="built_in">normalized</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»pç‚¹å‘å–æ ·å¾—åˆ°çš„å…‰æºæ–¹å‘å°„å‡ºä¸€æ¡å…‰çº¿wi</span></span><br><span class="line">    <span class="function">Ray <span class="title">wi</span><span class="params">(p.coords, p2lightDir)</span></span>;</span><br><span class="line">    <span class="comment">// ä»pç‚¹å‘å…‰æºæ–¹å‘å°„å‡ºä¸€æ¡å…‰çº¿å¾—åˆ°äº¤ç‚¹ inter_tmp,ä¸ºåˆ¤æ–­å…‰æºä¸ç€è‰²ç‚¹æ˜¯å¦æœ‰ç‰©ä½“åšå‡†å¤‡</span></span><br><span class="line">    Intersection inter_tmp = <span class="built_in">intersect</span>(wi);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­ ç€è‰²ç‚¹p å’Œ å…‰æºä¹‹é—´ ä¸­é—´æ²¡æœ‰ç‰©ä½“é˜»éš”</span></span><br><span class="line">    <span class="keyword">if</span> ((inter_l.coords - inter_tmp.coords).<span class="built_in">norm</span>() &lt; EPSILON * EPSILON)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œæˆ‘ç…§ç€ä¼ªä»£ç æŠŠå˜é‡éƒ½å†™å‡ºæ¥äº†ï¼Œæ¸…æ¥šä¸€ç‚¹</span></span><br><span class="line">        Vector3f L_i = inter_l.emit;</span><br><span class="line">        Vector3f f_r = p.m-&gt;<span class="built_in">eval</span>(wo, wi.direction, p.normal);</span><br><span class="line">        <span class="comment">// ï¼ˆç€è‰²ç‚¹æ³•å‘é‡ï¼‰å’Œï¼ˆç€è‰²ç‚¹-å…‰æºé‡‡æ ·ç‚¹ å‘é‡ï¼‰ä¹‹é—´çš„å¤¹è§’</span></span><br><span class="line">        <span class="type">float</span> cos0 = <span class="built_in">dotProduct</span>(wi.direction, p.normal);    </span><br><span class="line">        <span class="comment">// ï¼ˆå…‰æºå¹³é¢æ³•å‘é‡ï¼‰å’Œï¼ˆå…‰æºé‡‡æ ·ç‚¹-ç€è‰²ç‚¹ å‘é‡ï¼‰ä¹‹é—´çš„å¤¹è§’</span></span><br><span class="line">        <span class="type">float</span> cos0_ = <span class="built_in">dotProduct</span>(-wi.direction, inter_l.normal);</span><br><span class="line"></span><br><span class="line">        L_dir = L_i * f_r * cos0 * cos0_ / (p2lightDist * p2lightDist) / pdf_light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*----------------- 2. å…¶ä»–éå…‰æºå¯¹è¯¥ç€è‰²ç‚¹çš„è´¡çŒ®ï¼ˆé€’å½’æ±‚è§£ï¼Œç”¨RRï¼‰---------------*/</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿„ç½—æ–¯è½®ç›˜è·å¾—éšæœºæ¦‚ç‡</span></span><br><span class="line">    <span class="type">float</span> P_RR = RussianRoulette;</span><br><span class="line">    <span class="type">int</span> seed = <span class="built_in">rand</span>() % <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// ç”Ÿå­˜æ¦‚ç‡</span></span><br><span class="line">    <span class="keyword">if</span> (seed * <span class="number">1.0</span> / <span class="number">10</span> &gt; P_RR) <span class="keyword">return</span> L_dir; </span><br><span class="line">        </span><br><span class="line">    <span class="comment">// åœ¨ ç€è‰²ç‚¹p å–æ ·ä¸€ä¸ªæ–°çš„éšæœºæ–¹å‘</span></span><br><span class="line">    Vector3f wi_new = p.m-&gt;<span class="built_in">sample</span>(wo, p.normal);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘å°„å‡ºå»æ±‚ä¸å…¶ä»–ç‰©ä½“çš„äº¤ç‚¹</span></span><br><span class="line">    <span class="function">Ray <span class="title">r</span><span class="params">(p.coords, wi_new)</span></span>;</span><br><span class="line">    Intersection q = <span class="built_in">intersect</span>(r);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœqç‚¹çš„ç‰©ä½“ä¸æ˜¯å…‰æº</span></span><br><span class="line">    <span class="keyword">if</span> (q.happened &amp;&amp; !q.obj-&gt;<span class="built_in">hasEmit</span>())</span><br><span class="line">    &#123;</span><br><span class="line">        Vector3f f_r = p.m-&gt;<span class="built_in">eval</span>(wo, wi_new, p.normal);</span><br><span class="line">        <span class="type">float</span> cos0 = <span class="built_in">dotProduct</span>(wi_new, p.normal);</span><br><span class="line">        <span class="type">float</span> pdf_hemi = p.m-&gt;<span class="built_in">pdf</span>(wo,wi_new,p.normal);</span><br><span class="line"></span><br><span class="line">        L_indir = <span class="built_in">castRay</span>(r, depth+<span class="number">1</span>) * f_r * cos0 / pdf_hemi / P_RR;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> L_dir + L_indir;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>è·¯å¾„è¿½è¸ªç»“æœï¼š</strong></p><p>å¯èƒ½æ˜¯ç»™è™šæ‹Ÿæœºåˆ†é…çš„å†…å­˜å’ŒCPUæ•°é‡å°‘äº†â€¦ è·‘äº†40åˆ†é’Ÿï¼Œä¸»æœºçš„CPUä¹Ÿæ‰è·‘äº†20å¤šè€Œå·²â€¦</p><p><img src="/images/Games101/homework/07/01.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/29/games101/HomeWork%207/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 6ï¼šåŠ é€Ÿç»“æ„</title>
      <link>http://example.com/2024/01/29/games101/HomeWork%206/</link>
      <guid>http://example.com/2024/01/29/games101/HomeWork%206/</guid>
      <pubDate>Mon, 29 Jan 2024 13:54:27 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-6ï¼šåŠ é€Ÿç»“æ„&quot;&gt;&lt;a href=&quot;#HomeWork-6ï¼šåŠ é€Ÿç»“æ„&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 6ï¼šåŠ é€Ÿç»“æ„&quot;&gt;&lt;/a&gt;HomeWork 6ï¼šåŠ é€Ÿç»“æ„&lt;/h1&gt;&lt;p&gt;é¦–å…ˆï¼Œæ˜¯ &lt;strong&gt;Rende</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-6ï¼šåŠ é€Ÿç»“æ„"><a href="#HomeWork-6ï¼šåŠ é€Ÿç»“æ„" class="headerlink" title="HomeWork 6ï¼šåŠ é€Ÿç»“æ„"></a>HomeWork 6ï¼šåŠ é€Ÿç»“æ„</h1><p>é¦–å…ˆï¼Œæ˜¯ <strong>Render()</strong> å’Œ <strong>Triangle::getIntersection</strong>ï¼Œç…§ç€ä¸Šä¸€èŠ‚è¯¾ä¸€æ ·ï¼Œåªæ˜¯æœ‰äº›åœ°æ–¹çš„å½¢å¼éœ€è¦æ”¹æ”¹ï¼›</p><p>ç„¶åå°±æ˜¯æ­¤æ¬¡ä½œä¸šçš„è¦æ±‚ï¼š</p><ul><li><strong>ç†è§£ï¼Œå¹¶ä½¿ç”¨åŠ é€Ÿç»“æ„ BVHï¼Œæ‰¾åˆ°å…‰çº¿å’Œåœºæ™¯ä¸­ç‰©ä½“çš„äº¤ç‚¹</strong><ul><li><em><em>getIntersection(BVHBuildNode</em> node, const Ray ray)</em>*</li></ul></li><li><strong>åˆ¤æ–­å…‰çº¿å’ŒåŒ…å›´ç›’æ˜¯å¦ç›¸äº¤ï¼Œ</strong><ul><li><strong>IntersectP(const Ray&amp; ray, const Vector3f&amp; invDir, const std::array&lt;int, 3&gt;&amp; dirIsNeg)</strong></li></ul></li></ul><p>å¯¹äºçŸ¥è¯†ç‚¹å‚è€ƒè¿™ä¸€èŠ‚è¯¾ï¼š</p><p><a href="http://fjbq-blog.top/2024/01/09/games101/Lec%2014/">ã€Games 101ã€‘Lec 14ï¼šå…‰çº¿è¿½è¸ª 2ï¼ˆåŠ é€Ÿå…‰çº¿è¿½è¸ª å’Œ è¾å°„åº¦é‡å­¦ï¼‰</a></p><p><strong>Renderer.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªè¿˜æ˜¯ä¸€æ ·çš„ï¼Œç…§ç€ä¸Šä¸€ä¸ªä½œä¸šçš„å†™å°±è¡Œï¼ˆæ³¨æ„æœ‰äº›ä¸œè¥¿å˜äº†ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene&amp; scene)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¸§ç¼“å†²åŒºï¼Œç”¨äºä¿å­˜è¿”å›çš„é¢œè‰²</span></span><br><span class="line">    <span class="function">std::vector&lt;Vector3f&gt; <span class="title">framebuffer</span><span class="params">(scene.width * scene.height)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> scale = <span class="built_in">tan</span>(<span class="built_in">deg2rad</span>(scene.fov * <span class="number">0.5</span>));</span><br><span class="line">    <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè§†ç‚¹å˜äº†</span></span><br><span class="line">    <span class="function">Vector3f <span class="title">eye_pos</span><span class="params">(<span class="number">-1</span>, <span class="number">5</span>, <span class="number">10</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">uint32_t</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">float</span> x = (<span class="number">2</span> * (i + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.width - <span class="number">1</span>) * imageAspectRatio * scale;</span><br><span class="line">            <span class="type">float</span> y = (<span class="number">1</span> - <span class="number">2</span> * (j + <span class="number">0.5</span>) / (<span class="type">float</span>)scene.height) * scale;</span><br><span class="line"></span><br><span class="line">            Vector3f dir = <span class="built_in">Vector3f</span>(x, y, <span class="number">-1</span>); <span class="comment">// Don&#x27;t forget to normalize this direction!</span></span><br><span class="line">            dir = <span class="built_in">normalize</span>(dir);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è¿™é‡Œä¸æ˜¯ç›´æ¥è°ƒç”¨ castRay äº†... æ˜¯å…ˆå®šä¹‰å…‰çº¿rayï¼Œç„¶ååœ¨ä¼ åˆ°sceneçš„castrayæ–¹æ³•ä¸­ã€‚</span></span><br><span class="line">            <span class="function">Ray <span class="title">ray</span><span class="params">(eye_pos,dir)</span></span>;</span><br><span class="line">            framebuffer[m++] = scene.<span class="built_in">castRay</span>(ray,<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="built_in">UpdateProgress</span>(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">UpdateProgress</span>(<span class="number">1.f</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// save framebuffer to file</span></span><br><span class="line">    FILE* fp = <span class="built_in">fopen</span>(<span class="string">&quot;binary.ppm&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">        color[<span class="number">0</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x));</span><br><span class="line">        color[<span class="number">1</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y));</span><br><span class="line">        color[<span class="number">2</span>] = (<span class="type">unsigned</span> <span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z));</span><br><span class="line">        <span class="built_in">fwrite</span>(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(fp);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Triangle::getIntersection</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">inline</span> Intersection <span class="title">Triangle::getIntersection</span><span class="params">(Ray ray)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å°„çº¿å’Œä¸‰è§’å½¢çš„äº¤ç‚¹ï¼ˆç»“æ„ä½“ï¼Œå­˜äº†ä¸€äº›äº¤ç‚¹ä¿¡æ¯ï¼‰</span></span><br><span class="line">    Intersection inter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯´æ˜ä¸æ˜¯å…¥å°„å…‰çº¿</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">dotProduct</span>(ray.direction, normal) &gt; <span class="number">0</span>) <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="type">double</span> u, v, t_tmp = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›¸å½“äº S1</span></span><br><span class="line">    Vector3f pvec = <span class="built_in">crossProduct</span>(ray.direction, e2);</span><br><span class="line">    <span class="type">double</span> det = <span class="built_in">dotProduct</span>(e1, pvec);</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">fabs</span>(det) &lt; EPSILON) <span class="keyword">return</span> inter;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ç›¸å½“äº 1/dotProduct(S1,E1)</span></span><br><span class="line">    <span class="type">double</span> det_inv = <span class="number">1.</span> / det;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›¸å½“äº S</span></span><br><span class="line">    Vector3f tvec = ray.origin - v0;</span><br><span class="line">    u = <span class="built_in">dotProduct</span>(tvec, pvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (u &lt; <span class="number">0</span> || u &gt; <span class="number">1</span>) <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›¸å½“äº S2</span></span><br><span class="line">    Vector3f qvec = <span class="built_in">crossProduct</span>(tvec, e1);</span><br><span class="line">    v = <span class="built_in">dotProduct</span>(ray.direction, qvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (v &lt; <span class="number">0</span> || u + v &gt; <span class="number">1</span>) <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›¸å½“äº t</span></span><br><span class="line">    t_tmp = <span class="built_in">dotProduct</span>(e2, qvec) * det_inv;</span><br><span class="line">    <span class="keyword">if</span> (t_tmp &lt;= <span class="number">0</span>) <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢å®Œå–„ä¸€ä¸‹äº¤ç‚¹ä¿¡æ¯</span></span><br><span class="line">    <span class="comment">// æ ‡è®°ç›¸äº¤</span></span><br><span class="line">    inter.happened=<span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹åæ ‡ï¼ŒRayä¸­é‡è½½äº†(), ray(t_tmp) = ray.origin + ray.direction * t_tmp</span></span><br><span class="line">    inter.coords = <span class="built_in">Vector3f</span>(<span class="built_in">ray</span>(t_tmp));</span><br><span class="line">    inter.distance = t_tmp;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äº¤ç‚¹æ˜¯åœ¨è¿™ä¸ªä¸‰è§’å½¢ä¸Šï¼Œæ‰€ä»¥æŠŠè¿™ä¸ªä¸‰è§’å½¢çš„æè´¨ã€æ³•çº¿å’ŒæŒ‡é’ˆä¼ ç»™äº¤ç‚¹ã€‚</span></span><br><span class="line">    inter.m = m;</span><br><span class="line">    inter.normal = normal;</span><br><span class="line">    inter.obj = <span class="keyword">this</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> inter;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>BVH.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    BVH åŠ é€Ÿç»“æ„ï¼Œè·å– å…‰çº¿ å’Œ ä»¥nodeä¸ºæ ¹ç»“ç‚¹çš„å­æ ‘ çš„äº¤ç‚¹</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªç…§ç€è¯¾ä¸Šçš„ä¸ºä»£ç å†™å°±è¡Œäº†</span></span><br><span class="line"><span class="comment">    å¥½åƒä¸€ä¸ªèŠ‚ç‚¹æœ€å¤šåŒ…å«ä¸€ä¸ªç‰©ä½“</span></span><br><span class="line"><span class="comment">    è§„èŒƒä¸€ç‚¹ï¼Œæ³¨æ„æŒ‡é’ˆçš„åˆ¤ç©º</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Intersection <span class="title">BVHAccel::getIntersection</span><span class="params">(BVHBuildNode* node, <span class="type">const</span> Ray&amp; ray)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Intersection inter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(node == <span class="literal">nullptr</span>) <span class="keyword">return</span> inter;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å½“å‰èŠ‚ç‚¹æ˜¯å¶å­èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›å’Œè¿™ä¸ªç‰©ä½“çš„äº¤ç‚¹å°±è¡Œ</span></span><br><span class="line">    <span class="keyword">if</span>(node-&gt;left == <span class="literal">nullptr</span> &amp;&amp; node-&gt;right == <span class="literal">nullptr</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(node-&gt;object != <span class="literal">nullptr</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            inter = node-&gt;object-&gt;<span class="built_in">getIntersection</span>(ray);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> inter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®°å½•å…‰çº¿çš„æ–¹å‘</span></span><br><span class="line">    std::array&lt;<span class="type">int</span>, 3&gt; dirIsNeg;</span><br><span class="line">    dirIsNeg[<span class="number">0</span>] = <span class="built_in">int</span>(ray.direction.x &lt; <span class="number">0</span>);</span><br><span class="line">    dirIsNeg[<span class="number">1</span>] = <span class="built_in">int</span>(ray.direction.y &lt; <span class="number">0</span>);</span><br><span class="line">    dirIsNeg[<span class="number">2</span>] = <span class="built_in">int</span>(ray.direction.z &lt; <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    Intersection inter1, inter2;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// çœ‹çœ‹æ˜¯å¦å’Œå·¦è¾¹çš„åŒ…å›´ç›’ç›¸äº¤</span></span><br><span class="line">    <span class="keyword">if</span>(node-&gt;left != <span class="literal">nullptr</span> &amp;&amp; node-&gt;left-&gt;bounds.<span class="built_in">IntersectP</span>(ray, ray.direction_inv, dirIsNeg))</span><br><span class="line">    &#123;</span><br><span class="line">        inter1 = <span class="built_in">getIntersection</span>(node-&gt;left,ray);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çœ‹çœ‹æ˜¯å¦å’Œå³è¾¹çš„åŒ…å›´ç›’ç›¸äº¤</span></span><br><span class="line">    <span class="keyword">if</span>(node-&gt;right != <span class="literal">nullptr</span> &amp;&amp; node-&gt;right-&gt;bounds.<span class="built_in">IntersectP</span>(ray, ray.direction_inv, dirIsNeg))</span><br><span class="line">    &#123;</span><br><span class="line">        inter2 = <span class="built_in">getIntersection</span>(node-&gt;right,ray);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæœ‰ä¸¤ä¸ªäº¤ç‚¹ï¼Œè¿”å›æœ€è¿‘çš„é‚£ä¸ª</span></span><br><span class="line">    <span class="keyword">return</span> inter1.distance &lt; inter2.distance ? inter1 : inter2;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Bounds3.hpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™ä¸ªå‡½æ•°çš„ä½œç”¨æ˜¯åˆ¤æ–­åŒ…å›´ç›’ BoundingBox ä¸å…‰çº¿æ˜¯å¦ç›¸äº¤</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="type">bool</span> <span class="title">Bounds3::IntersectP</span><span class="params">(<span class="type">const</span> Ray&amp; ray, <span class="type">const</span> Vector3f&amp; invDir, <span class="type">const</span> std::array&lt;<span class="type">int</span>, <span class="number">3</span>&gt;&amp; dirIsNeg)</span> <span class="type">const</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// invDir: ray direction(x,y,z), invDir = (1.0/x,1.0/y,1.0/z)ï¼Œä½¿ç”¨è¿™ä¸ªæ˜¯å› ä¸ºä¹˜æ³•æ¯”é™¤æ³•å¿«</span></span><br><span class="line">    <span class="comment">// dirIsNeg: ray direction(x,y,z), dirIsNeg = [int(x&gt;0),int(y&gt;0),int(z&gt;0)], ç”¨è¿™ä¸ªæ¥ç®€åŒ–ä½ çš„é€»è¾‘</span></span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> tx_min = (pMin.x - ray.origin.x) * invDir.x;</span><br><span class="line">    <span class="type">float</span> tx_max = (pMax.x - ray.origin.x) * invDir.x;</span><br><span class="line">    <span class="keyword">if</span> (dirIsNeg[<span class="number">0</span>]) std::<span class="built_in">swap</span>(tx_min, tx_max);</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> ty_min = (pMin.y - ray.origin.y) * invDir.y;</span><br><span class="line">    <span class="type">float</span> ty_max = (pMax.y - ray.origin.y) * invDir.y;</span><br><span class="line">    <span class="keyword">if</span> (dirIsNeg[<span class="number">1</span>]) std::<span class="built_in">swap</span>(ty_min, ty_max);</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> tz_min = (pMin.z - ray.origin.z) * invDir.z;</span><br><span class="line">    <span class="type">float</span> tz_max = (pMax.z - ray.origin.z) * invDir.z;</span><br><span class="line">    <span class="keyword">if</span> (dirIsNeg[<span class="number">2</span>]) std::<span class="built_in">swap</span>(tz_min, tz_max);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> t_enter = std::<span class="built_in">max</span>(std::<span class="built_in">max</span>(tx_min, ty_min), tz_min);</span><br><span class="line">    <span class="type">float</span> t_exit = std::<span class="built_in">min</span>(std::<span class="built_in">min</span>(tx_max, ty_max), tz_max);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> t_exit &gt; <span class="number">0.0f</span> &amp;&amp; t_enter &lt; t_exit;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/06/01.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/29/games101/HomeWork%206/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤</title>
      <link>http://example.com/2024/01/29/games101/HomeWork%205/</link>
      <guid>http://example.com/2024/01/29/games101/HomeWork%205/</guid>
      <pubDate>Mon, 29 Jan 2024 13:54:27 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤&quot;&gt;&lt;a href=&quot;#HomeWork-5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤&quot;&gt;&lt;/a&gt;HomeWork 5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤&lt;/h1&gt;&lt;p&gt;è¿™ä¸€</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤"><a href="#HomeWork-5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤" class="headerlink" title="HomeWork 5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤"></a>HomeWork 5ï¼šå…‰çº¿ä¸ä¸‰è§’å½¢ç›¸äº¤</h1><p>è¿™ä¸€ä¸ªä½œä¸šä¸»è¦æ˜¯å…‰çº¿è¿½è¸ªï¼Œæˆ‘ä»¬è¦å®ç°çš„æ˜¯ï¼š</p><ul><li>ä»æ¯ä¸ªåƒç´ æ‰“å‡ºä¸€æ¡å…‰çº¿ï¼›</li><li>åˆ¤æ–­å…‰çº¿å’Œä¸‰è§’å½¢æ˜¯å¦ç›¸äº¤</li></ul><p>æœ‰çš„ä¸œè¥¿è¯¾ä¸Šæ²¡æœ‰è®²ï¼Œå…·ä½“çš„è¯å¯ä»¥çœ‹ä¸€ä¸‹æ³¨é‡Šï¼</p><p>åŒæ­¥çš„çŸ¥è¯†ç‚¹åœ¨è¿™ä¸€ç‰‡æ–‡ç« ï¼š</p><p><a href="http://fjbq-blog.top/2024/01/09/games101/Lec%2013/">ã€Games 101ã€‘Lec 13ï¼šå…‰çº¿è¿½è¸ª 1ï¼ˆShadow Mappingï¼ŒWhitted-Style Ray Tracingï¼‰</a></p><p><strong>Renderer.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä¸»æ¸²æŸ“å‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">    åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬è¿­ä»£å›¾åƒä¸­çš„æ‰€æœ‰åƒç´ ï¼Œä»æ¯ä¸ªåƒç´ æ‰“å‡ºä¸€æ¡å…‰çº¿åˆ°åœºæ™¯ä¸­ï¼›</span></span><br><span class="line"><span class="comment">    framebuffer çš„å†…å®¹è¢«ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    æˆ‘çš„å¦ˆï¼Œè¿™ä¸ªæ˜¯çœŸçš„æœ‰ç‚¹éš¾å“‡... ä¸»è¦æ˜¯è¯¾ä¸Šä¹Ÿæ²¡è®²...</span></span><br><span class="line"><span class="comment">    å…·ä½“å¯ä»¥çœ‹è¿™ä¸¤ç¯‡æ–‡ç« ï¼š</span></span><br><span class="line"><span class="comment">        https://zhuanlan.zhihu.com/p/475136497</span></span><br><span class="line"><span class="comment">        https://www.scratchapixel.com/lessons/3d-basic-rendering/ray-tracing-generating-camera-rays/generating-camera-rays.html</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ç‰¹åˆ«æ˜¯ç¬¬äºŒç¯‡ï¼Œåˆ†æçš„ç‰¹åˆ«æ¸…æ¥šï¼</span></span><br><span class="line"><span class="comment">    çœ‹å®Œå°±çŸ¥é“è¦å¹²å˜›äº†ï¼ˆå°±æ˜¯éœ€è¦å˜æ¢ä¸€ä¸‹åæ ‡ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Renderer::Render</span><span class="params">(<span class="type">const</span> Scene&amp; scene)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// å¸§ç¼“å†²åŒºï¼Œç”¨äºä¿å­˜è¿”å›çš„é¢œè‰²</span></span><br><span class="line">    <span class="function">std::vector&lt;Vector3f&gt; <span class="title">framebuffer</span><span class="params">(scene.width * scene.height)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> scale = std::<span class="built_in">tan</span>(<span class="built_in">deg2rad</span>(scene.fov * <span class="number">0.5f</span>));</span><br><span class="line">    <span class="type">float</span> imageAspectRatio = scene.width / (<span class="type">float</span>)scene.height;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨è¿™ä¸ªå˜é‡ä½œä¸ºçœ¼ç›çš„ä½ç½®æ¥å¼€å§‹ä½ çš„å…‰çº¿ã€‚</span></span><br><span class="line">    <span class="function">Vector3f <span class="title">eye_pos</span><span class="params">(<span class="number">0</span>)</span></span>;</span><br><span class="line">    <span class="type">int</span> m = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; scene.height; ++j)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; scene.width; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">/*</span></span><br><span class="line"><span class="comment">                <span class="doctag">TODO:</span>æ‰¾åˆ°å½“å‰åƒç´ çš„xå’Œyä½ç½®ï¼Œä»¥è·å¾—é€šè¿‡å®ƒçš„æ–¹å‘çŸ¢é‡ã€‚</span></span><br><span class="line"><span class="comment">                æ­¤å¤–ï¼Œä¸è¦å¿˜è®°å°†å®ƒä»¬ä¸å˜é‡*scale*ç›¸ä¹˜ï¼Œå¹¶å°†x(æ°´å¹³)å˜é‡ä¸*imageAspectRatio*ç›¸ä¹˜</span></span><br><span class="line"><span class="comment">            */</span>   </span><br><span class="line">            <span class="type">float</span> x = (<span class="number">2.0</span> * i / scene.width - <span class="number">1.0</span>) * scale * imageAspectRatio;</span><br><span class="line">            <span class="type">float</span> y = (<span class="number">1.0</span> - <span class="number">2.0</span> *j / scene.height) * scale;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ«å¿˜äº†å½’ä¸€åŒ–è¿™ä¸ªæ–¹å‘</span></span><br><span class="line">            Vector3f dir = <span class="built_in">Vector3f</span>(x, y, <span class="number">-1</span>); <span class="comment">// Don&#x27;t forget to normalize this direction!</span></span><br><span class="line">            dir = <span class="built_in">normalize</span>(dir);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// è°ƒç”¨ castRay æ¥è·å–æœ€ç»ˆçš„é¢œè‰²</span></span><br><span class="line">            framebuffer[m++] = <span class="built_in">castRay</span>(eye_pos, dir, scene, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// è¾“å‡ºä¸€ä¸‹ï¼Ÿ</span></span><br><span class="line">        <span class="built_in">UpdateProgress</span>(j / (<span class="type">float</span>)scene.height);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†ç¼“å†²åŒºçš„é¢œè‰²ä¿å­˜åˆ°æ–‡ä»¶ä¸­ï¼ˆå¸§ç¼“å†²åŒºä¸­çš„ä¿¡æ¯å°†è¢«ä¿å­˜ä¸ºå›¾åƒï¼‰</span></span><br><span class="line">    FILE* fp = <span class="built_in">fopen</span>(<span class="string">&quot;binary.ppm&quot;</span>, <span class="string">&quot;wb&quot;</span>);</span><br><span class="line">    (<span class="type">void</span>)<span class="built_in">fprintf</span>(fp, <span class="string">&quot;P6\n%d %d\n255\n&quot;</span>, scene.width, scene.height);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> i = <span class="number">0</span>; i &lt; scene.height * scene.width; ++i) &#123;</span><br><span class="line">        <span class="type">static</span> <span class="type">unsigned</span> <span class="type">char</span> color[<span class="number">3</span>];</span><br><span class="line">        color[<span class="number">0</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].x));</span><br><span class="line">        color[<span class="number">1</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].y));</span><br><span class="line">        color[<span class="number">2</span>] = (<span class="type">char</span>)(<span class="number">255</span> * <span class="built_in">clamp</span>(<span class="number">0</span>, <span class="number">1</span>, framebuffer[i].z));</span><br><span class="line">        <span class="built_in">fwrite</span>(color, <span class="number">1</span>, <span class="number">3</span>, fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">fclose</span>(fp);    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Triangle.hpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    åˆ¤æ–­å°„çº¿æ˜¯å¦å’Œä¸‰è§’å½¢ç›¸äº¤</span></span><br><span class="line"><span class="comment">    ç”¨ Moller Trumbore ç®—æ³•ï¼Œè¿™ä¸ªç›´æ¥å¥—å…¬å¼è§£å‡ºæ¥å°±è¡Œ</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">rayTriangleIntersect</span><span class="params">(<span class="type">const</span> Vector3f&amp; v0, <span class="type">const</span> Vector3f&amp; v1, <span class="type">const</span> Vector3f&amp; v2, <span class="type">const</span> Vector3f&amp; orig,</span></span></span><br><span class="line"><span class="params"><span class="function">                          <span class="type">const</span> Vector3f&amp; dir, <span class="type">float</span>&amp; tnear, <span class="type">float</span>&amp; u, <span class="type">float</span>&amp; v)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Vector3f E1 = v1 - v0;</span><br><span class="line">    Vector3f E2 = v2 - v0;</span><br><span class="line">    Vector3f S = orig - v0;</span><br><span class="line">    Vector3f S1 = <span class="built_in">crossProduct</span>(dir, E2);</span><br><span class="line">    Vector3f S2 = <span class="built_in">crossProduct</span>(S, E1);</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> t = <span class="built_in">dotProduct</span>(S2,E2) / <span class="built_in">dotProduct</span>(S1,E1);</span><br><span class="line">    <span class="type">float</span> b1 = <span class="built_in">dotProduct</span>(S1,S) / <span class="built_in">dotProduct</span>(S1,E1);</span><br><span class="line">    <span class="type">float</span> b2 = <span class="built_in">dotProduct</span>(S2,dir) / <span class="built_in">dotProduct</span>(S1,E1);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éƒ½ &gt;0 æ‰è¡¨ç¤ºæœ‰è§£</span></span><br><span class="line">    <span class="keyword">if</span>(t &gt; <span class="number">0</span> &amp;&amp; b1 &gt; <span class="number">0</span> &amp;&amp; b2 &gt; <span class="number">0</span> &amp;&amp; <span class="number">1</span> - (b1 + b2) &gt; <span class="number">0</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        tnear = t;</span><br><span class="line">        u = b1;</span><br><span class="line">        v = b2;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>å…‰çº¿è¿½è¸ªç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/05/01.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/29/games101/HomeWork%205/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ</title>
      <link>http://example.com/2024/01/29/games101/HomeWork%208/</link>
      <guid>http://example.com/2024/01/29/games101/HomeWork%208/</guid>
      <pubDate>Mon, 29 Jan 2024 13:54:27 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ&quot;&gt;&lt;a href=&quot;#HomeWork-8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ&quot;&gt;&lt;/a&gt;HomeWork 8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ&lt;/h1&gt;&lt;p&gt;è¿™èŠ‚è¯¾æ¯”è¾ƒç®€å•ï¼Œéƒ½æ˜¯</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ"><a href="#HomeWork-8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ" class="headerlink" title="HomeWork 8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ"></a>HomeWork 8ï¼šè´¨ç‚¹å¼¹ç°§ç³»ç»Ÿ</h1><p>è¿™èŠ‚è¯¾æ¯”è¾ƒç®€å•ï¼Œéƒ½æ˜¯å¥—å…¬å¼å°±è¡Œï¼›</p><p>æœ‰ä¸ªç‚¹å¾—æä¸€ä¸‹ï¼Œä¸€å¼€å§‹sbäº†ï¼Œåœ¨srcé‡Œé¢é—´çš„buildæ–‡ä»¶å¤¹ï¼Œç„¶åcmakeï¼Œç»“æœä¸€ç›´æŠ¥é”™â€¦</p><p>å®é™…ä¸Šæ˜¯åº”è¯¥åœ¨ä¸Šä¸€çº§å»ºçš„â€¦ï¼ˆä¹Ÿå°±æ˜¯ build å’Œ src æ–‡ä»¶å¤¹åŒä¸€çº§ï¼‰</p><p>çŸ¥è¯†ç‚¹å‚è€ƒçš„è¯¾ç¨‹ï¼š</p><p><a href="https://fjbq-blog.top/2024/01/21/games101/Lec%2021/">ã€Games 101ã€‘Lec 21ï¼šåŠ¨ç”»</a></p><p><strong>rope.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">        æ„é€ å‡½æ•°</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªæ„é€ å‡½æ•°åº”è¯¥å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ç»³å­(Rope) å¯¹è±¡ï¼Œè¯¥å¯¹è±¡ä»start å¼€å§‹ï¼Œend ç»“æŸï¼ŒåŒ…å« num_nodes ä¸ªèŠ‚ç‚¹ã€‚</span></span><br><span class="line"><span class="comment">        </span></span><br><span class="line"><span class="comment">        - startï¼šèµ·å§‹èŠ‚ç‚¹çš„åæ ‡</span></span><br><span class="line"><span class="comment">        - endï¼šæœ€ç»ˆèŠ‚ç‚¹çš„åæ ‡</span></span><br><span class="line"><span class="comment">        - num_nodesï¼šèŠ‚ç‚¹ä¸ªæ•°</span></span><br><span class="line"><span class="comment">        - node_massï¼šèŠ‚ç‚¹çš„è´¨é‡</span></span><br><span class="line"><span class="comment">        - kï¼šå¼¹ç°§çš„å¼ªåº¦ç³»æ•°</span></span><br><span class="line"><span class="comment">        - pinned_nodesï¼šå¼¹ç°§ä¸¤ä¸ªç«¯ç‚¹çš„ç´¢å¼•</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    Rope::<span class="built_in">Rope</span>(Vector2D start, Vector2D end, <span class="type">int</span> num_nodes, <span class="type">float</span> node_mass, <span class="type">float</span> k, vector&lt;<span class="type">int</span>&gt; pinned_nodes)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–è´¨ç‚¹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_nodes; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// è½¬æˆdoubleå†åšé™¤æ³•ï¼Œå¦åˆ™å°±ä¼šæˆªæ–­æˆint</span></span><br><span class="line">            Vector2D pos = start + (end - start) * ((<span class="type">double</span>)i / ((<span class="type">double</span>)num_nodes - <span class="number">1.0</span>));</span><br><span class="line">            masses.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Mass</span>(pos, node_mass, <span class="literal">false</span>));</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–å¼¹ç°§</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; num_nodes - <span class="number">1</span>; ++i)</span><br><span class="line">        &#123;</span><br><span class="line">            springs.<span class="built_in">push_back</span>(<span class="keyword">new</span> <span class="built_in">Spring</span>(masses[i], masses[i + <span class="number">1</span>], k));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;i : pinned_nodes) </span><br><span class="line">        &#123;</span><br><span class="line">            masses[i]-&gt;pinned = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼ / åŠéšå¼æ¬§æ‹‰æ³•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Rope::simulateEuler</span><span class="params">(<span class="type">float</span> <span class="type">delta_t</span>, Vector2D gravity)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="comment">// å®ç°èƒ¡å…‹å®šå¾‹ï¼šéå†æ‰€æœ‰çš„å¼¹ç°§ï¼Œæ ¹æ®æ‹‰ä¼¸çš„é•¿åº¦è®¡ç®—æ‹‰åŠ›ï¼ˆå¥—å…¬å¼å°±è¡Œï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : springs)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> len = (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position).<span class="built_in">norm</span>();</span><br><span class="line">            s-&gt;m1-&gt;forces += -(s-&gt;k) * (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position) / len * (len - s-&gt;rest_length);</span><br><span class="line">            s-&gt;m2-&gt;forces += -(s-&gt;k) * (s-&gt;m2-&gt;position - s-&gt;m1-&gt;position) / len * (len - s-&gt;rest_length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ›´æ–° åŠ é€Ÿåº¦ï¼Œé€Ÿåº¦ï¼Œä½ç½®ï¼ˆä¹Ÿæ˜¯å¥—å…¬å¼å°±è¡Œï¼‰</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;m : masses)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!m-&gt;pinned)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    åŠ ä¸Šé‡åŠ›ä½œç”¨ä¸‹çš„åŠ›ï¼Œç„¶åè®¡ç®—æ–°çš„é€Ÿåº¦å’Œä½ç½®</span></span><br><span class="line"><span class="comment">                    éšå¼ï¼šå…ˆæ›´æ–°é€Ÿåº¦ï¼Œå†æ›´æ–°ä½ç½®</span></span><br><span class="line"><span class="comment">                    æ˜¾å¼ï¼šå…ˆæ›´æ–°ä½ç½®ï¼Œå†æ›´æ–°é€Ÿåº¦ï¼ˆç›´æ¥å°±é£å‡ºå»äº†...ï¼‰</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// åŠ ä¸Šè´¨ç‚¹çš„é‡åŠ›ï¼Œé‡åŠ› = é‡åŠ›åŠ é€Ÿåº¦ * è´¨é‡</span></span><br><span class="line">                m-&gt;forces += gravity * m-&gt;mass;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// å¢åŠ å…¨å±€é˜»å°¼åŠ›</span></span><br><span class="line">                <span class="type">float</span> k_d = <span class="number">0.005</span>;       </span><br><span class="line">                Vector2D f_d = -k_d * m-&gt;velocity;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åŠ ä¸Šé˜»å°¼çš„åŠ›</span></span><br><span class="line">                m-&gt;forces += f_d;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åŠ é€Ÿåº¦</span></span><br><span class="line">                Vector2D a = m-&gt;forces / m-&gt;mass;</span><br><span class="line"></span><br><span class="line">                m-&gt;velocity += a * <span class="type">delta_t</span>;                 <span class="comment">// å†æ›´æ–°é€Ÿåº¦</span></span><br><span class="line">                m-&gt;position += m-&gt;velocity * <span class="type">delta_t</span>;       <span class="comment">// å…ˆæ›´æ–°ä½ç½®ï¼Œå°±æ˜¯ç”¨ä¸Šä¸€æ—¶åˆ»çš„é€Ÿåº¦æ›´æ–°</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// Reset all forces on each mass</span></span><br><span class="line">            m-&gt;forces = <span class="built_in">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ˜¾å¼ Verlet æ³•</span></span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">Rope::simulateVerlet</span><span class="params">(<span class="type">float</span> <span class="type">delta_t</span>, Vector2D gravity)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;s : springs)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> len = (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position).<span class="built_in">norm</span>();</span><br><span class="line">            s-&gt;m1-&gt;forces += -(s-&gt;k) * (s-&gt;m1-&gt;position - s-&gt;m2-&gt;position) / len * (len - s-&gt;rest_length);</span><br><span class="line">            s-&gt;m2-&gt;forces += -(s-&gt;k) * (s-&gt;m2-&gt;position - s-&gt;m1-&gt;position) / len * (len - s-&gt;rest_length);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">auto</span> &amp;m : masses)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (!m-&gt;pinned)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">/*</span></span><br><span class="line"><span class="comment">                    æ˜¾ç¤ºVerletæ³•ï¼šæŠŠå¼¹ç°§çš„é•¿åº¦ä¿æŒåŸé•¿ä½œä¸ºçº¦æŸï¼Œç§»åŠ¨æ¯ä¸ªè´¨ç‚¹çš„ä½ç½®</span></span><br><span class="line"><span class="comment">                    ä¹Ÿæ˜¯å¥—å…¬å¼å°±è¡Œï¼š</span></span><br><span class="line"><span class="comment">                        x(t+1) = x(t) + (1 - damping_factor) * ([x(t) - x(t-1)] + a * dt * dt)</span></span><br><span class="line"><span class="comment">                    å¯ä»¥çœ‹åˆ°éœ€è¦ x(t-1)ï¼Œæ‰€ä»¥å¾—å…ˆå­˜ä¸€ä¸‹</span></span><br><span class="line"><span class="comment">                */</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment">// åŠ ä¸Šè´¨ç‚¹çš„é‡åŠ›ï¼Œé‡åŠ› = é‡åŠ›åŠ é€Ÿåº¦ * è´¨é‡</span></span><br><span class="line">                m-&gt;forces += gravity * m-&gt;mass;</span><br><span class="line">                Vector2D a = m-&gt;forces/m-&gt;mass;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// x(t-1)</span></span><br><span class="line">                Vector2D lastPosition = m-&gt;position;    </span><br><span class="line"></span><br><span class="line">                <span class="comment">// é˜»å°¼</span></span><br><span class="line">                <span class="type">float</span> damping_factor = <span class="number">0.00005f</span>;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// x(t+1) = x(t) + (1 - damping_factor) * ([x(t) - x(t-1)] + a * dt * dt)</span></span><br><span class="line">                m-&gt;position += (<span class="number">1</span> - damping_factor) * (m-&gt;position - m-&gt;last_position + a * <span class="type">delta_t</span> * <span class="type">delta_t</span>);</span><br><span class="line">                m-&gt;last_position = lastPosition;</span><br><span class="line">            &#125;</span><br><span class="line">            m-&gt;forces = <span class="built_in">Vector2D</span>(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/08/01.png"></p><p><img src="/images/Games101/homework/08/02.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/29/games101/HomeWork%208/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨</title>
      <link>http://example.com/2024/01/27/games101/HomeWork%200/</link>
      <guid>http://example.com/2024/01/27/games101/HomeWork%200/</guid>
      <pubDate>Sat, 27 Jan 2024 15:51:29 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨&quot;&gt;&lt;a href=&quot;#HomeWork-0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨&quot;&gt;&lt;/a&gt;HomeWork 0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨&lt;/h1&gt;&lt;p&gt;é…ç¯å¢ƒâ€¦&lt;/p&gt;
&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨"><a href="#HomeWork-0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨" class="headerlink" title="HomeWork 0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨"></a>HomeWork 0ï¼šè™šæ‹Ÿæœºçš„ä½¿ç”¨</h1><p>é…ç¯å¢ƒâ€¦</p><p>çœŸçš„æ˜¯ä¸€æ³¢ä¸‰æŠ˜å•Šï¼Œæ£é¼“äº†å¥½ä¹…â€¦</p><p>è¿˜å¥½è™šæ‹Ÿæœºé‡Œé¢ä»€ä¹ˆéƒ½æœ‰äº†</p><p>é¦–å…ˆæŒ‰ç…§ pdf é‡Œé¢çš„æµç¨‹èµ°å°±è¡Œäº†ï¼Œä¸‹é¢è®°å½•ä¸€ä¸‹ä¸€äº›é—®é¢˜ï¼š</p><h2 id="é»‘å±â€¦"><a href="#é»‘å±â€¦" class="headerlink" title="é»‘å±â€¦"></a>é»‘å±â€¦</h2><p>æˆ‘æ˜¯é‡å¯ä¹‹åå°±ä¼šé»‘å±ï¼Œè¿˜æ²¡è¾“å…¥å¯†ç å‘¢â€¦</p><p>è¿™ä¸ªé—®é¢˜æˆ‘ç›´æ¥åˆ æ‰è™šæ‹Ÿæœºï¼Œå¦‚ä½•é‡æ–°åˆ›å»ºä¸€ä¸ªå°±å¥½äº†ï¼›</p><h2 id="å®‰è£…-å¢å¼ºåŠŸèƒ½-æ˜¾ç¤º-æ— æ³•æŒ‚è½½å…‰ç›˜ä»€ä¹ˆçš„"><a href="#å®‰è£…-å¢å¼ºåŠŸèƒ½-æ˜¾ç¤º-æ— æ³•æŒ‚è½½å…‰ç›˜ä»€ä¹ˆçš„" class="headerlink" title="å®‰è£… å¢å¼ºåŠŸèƒ½ æ˜¾ç¤º æ— æ³•æŒ‚è½½å…‰ç›˜ä»€ä¹ˆçš„"></a>å®‰è£… å¢å¼ºåŠŸèƒ½ æ˜¾ç¤º æ— æ³•æŒ‚è½½å…‰ç›˜ä»€ä¹ˆçš„</h2><p>é¦–å…ˆæ£€æŸ¥ä¸€ä¸‹è™šæ‹Ÿæœºæ˜¯å¦æœ‰ VBox_GAs_â€¦ å…‰ç›˜ï¼Œæœ‰çš„è¯å…ˆå¼¹å‡ºä»–ï¼Œç„¶åå†å°è¯•å®‰è£…ï¼›</p><p>ç„¶åå¯èƒ½ä¼šå¤±è´¥ï¼Œçœ‹ä¸‹é¢è¿™ä¸¤ç¯‡ï¼š</p><p><a href="https://zhuanlan.zhihu.com/p/560813527">VirtualBox å®‰è£… ubuntuåå®‰è£…å¢å¼ºå·¥å…·æ— æ•ˆçš„è§£å†³åŠæ³• - çŸ¥ä¹ (zhihu.com)</a></p><p><a href="https://blog.csdn.net/qq_34777600/article/details/99337930">VirtualBoxï¼šunable to access â€œVBox_GAS_6.8.XXX-CSDNåšå®¢</a></p><p>æˆåŠŸå®‰è£…ä¹‹åå°±èƒ½ï¼š</p><p>è°ƒæ•´è™šæ‹Ÿæœºçš„åˆ†è¾¨ç‡ï¼›</p><p>ä¸»æœºå’Œè™šæ‹Ÿæœºä¹‹é—´æ‹–æ‹½æ–‡ä»¶ï¼›</p><p>ç­‰ï¼›</p><p>ç„¶åç»§ç»­ç…§ç€ pdf é‡Œé¢æ“ä½œå°±è¡Œäº†</p><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><p><strong>ä¸‹é¢æ˜¯ä½œä¸š0çš„ä»£ç ï¼š</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;eigen3/Eigen/Core&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;eigen3/Eigen/Dense&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span><span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">Test</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è¿™ä¸ªä¸€äº›åŸºæœ¬è¿ç®—</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of cpp \n&quot;</span>;</span><br><span class="line">    <span class="type">float</span> a = <span class="number">1.0</span>, b = <span class="number">2.0</span>;</span><br><span class="line">    std::cout &lt;&lt; a &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; a/b &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">sqrt</span>(b) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">acos</span>(<span class="number">-1</span>) &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; std::<span class="built_in">sin</span>(<span class="number">30.0</span>/<span class="number">180.0</span>*<span class="built_in">acos</span>(<span class="number">-1</span>)) &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Example of vector</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of vector \n&quot;</span>;</span><br><span class="line">    <span class="comment">//è¿™ä¸ª Vector3f æ˜¯å®šä¹‰äº†ä¸€ä¸ªä¸‰ç»´å‘é‡ï¼Œfloat(æ³¨æ„è¿™é‡Œå…¶å®ä¹Ÿå°±æ˜¯ä¸€ä¸ª 3x1 çš„çŸ©é˜µ)</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">v</span><span class="params">(<span class="number">1.0f</span>,<span class="number">2.0f</span>,<span class="number">3.0f</span>)</span></span>;</span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">w</span><span class="params">(<span class="number">1.0f</span>,<span class="number">0.0f</span>,<span class="number">0.0f</span>)</span></span>;</span><br><span class="line">    <span class="comment">// vector output</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of output \n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; v &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// vector add</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of add \n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; v + w &lt;&lt; std::endl;</span><br><span class="line">    <span class="comment">// vector scalar multiply</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of scalar multiply \n&quot;</span>;</span><br><span class="line">    std::cout &lt;&lt; v * <span class="number">3.0f</span> &lt;&lt; std::endl;</span><br><span class="line">    std::cout &lt;&lt; <span class="number">2.0f</span> * v &lt;&lt; std::endl;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Example of matrix</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Example of matrix \n&quot;</span>;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è¿™ä¸ª Matrix3f æ˜¯å®šä¹‰äº†ä¸€ä¸ª3x3çš„floatçš„çŸ©é˜µï¼›</span></span><br><span class="line"><span class="comment">        å…¶å®è·³è¿›å»çœ‹æºç å°±çŸ¥é“äº†ï¼Œé€šè¿‡æ¨¡æ¿å’Œå®å®šä¹‰å®ç°çš„ï¼›</span></span><br><span class="line"><span class="comment">    */</span> </span><br><span class="line">    Eigen::Matrix3f i,j,ans;</span><br><span class="line">    i &lt;&lt; <span class="number">1.0</span>, <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">4.0</span>, <span class="number">5.0</span>, <span class="number">6.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>, <span class="number">9.0</span>;</span><br><span class="line">    j &lt;&lt; <span class="number">2.0</span>, <span class="number">3.0</span>, <span class="number">1.0</span>, <span class="number">4.0</span>, <span class="number">6.0</span>, <span class="number">5.0</span>, <span class="number">9.0</span>, <span class="number">7.0</span>, <span class="number">8.0</span>;</span><br><span class="line">    <span class="comment">// matrix output</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;Example of output \n&quot;</span>;</span><br><span class="line">    cout &lt;&lt; i &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// matrix add i + j</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is matrix add : \n&quot;</span>;</span><br><span class="line">    ans = i + j;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// matrix scalar multiply i * 2.0</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is matrix scalar multiply : \n&quot;</span>;</span><br><span class="line">    ans = i * <span class="number">20</span>;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// matrix multiply i * j</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is matrix multiply : \n&quot;</span>;</span><br><span class="line">    ans = i * j;</span><br><span class="line">    cout &lt;&lt; ans &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    matrix multiply vector i * v</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªå°±æ˜¯å®šä¹‰ä¸€ä¸ªè‡ªå®šä¹‰å¤§å°çš„floatçŸ©é˜µï¼Œæˆ‘è¿™é‡Œå®šä¹‰çš„æ˜¯ 1x3 çš„ï¼›</span></span><br><span class="line"><span class="comment">    å› ä¸º v æ˜¯ä¸€ä¸ª 1x3 çš„ï¼Œi æ˜¯ä¸€ä¸ª 3x3 çš„ï¼›</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;this is matrix multiply vector : \n&quot;</span>;</span><br><span class="line">    <span class="function">Eigen::MatrixXf <span class="title">ans1</span><span class="params">(<span class="number">1</span>,<span class="number">3</span>)</span></span>;</span><br><span class="line">    ans1 = i * v;</span><br><span class="line">    cout &lt;&lt; ans1 &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">ä½œä¸šæè¿°:</span></span><br><span class="line"><span class="comment">    ç»™å®šä¸€ä¸ªç‚¹ P=(2,1), å°†è¯¥ç‚¹ç»•åŸç‚¹å…ˆé€†æ—¶é’ˆæ—‹è½¬ 45â—¦ï¼Œå†å¹³ç§» (1,2), è®¡ç®—å‡ºå˜æ¢åç‚¹çš„åæ ‡ï¼ˆè¦æ±‚ç”¨é½æ¬¡åæ ‡è¿›è¡Œè®¡ç®—ï¼‰ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">åˆ†æï¼š</span></span><br><span class="line"><span class="comment">    1. é¦–å…ˆè¯´åˆ°è¦ç”¨é½æ¬¡åæ ‡è¡¨ç¤ºï¼Œæˆ‘ä»¬å›é¡¾ä¸€ä¸‹ï¼Œ2ç»´çš„ç‚¹ç”¨é½æ¬¡åæ ‡è¡¨ç¤ºï¼Œåˆ™éœ€è¦åŠ ä¸Šä¸€ä¸ª1çš„ç»´ï¼Œä¹Ÿå°±æ˜¯ï¼ˆ2ï¼Œ1ï¼Œ1ï¼‰ï¼›</span></span><br><span class="line"><span class="comment">    2. ç„¶åå¹³ç§»æ—‹è½¬ï¼Œæˆ‘ä»¬å¯ä»¥æ„é€ ä¸€ä¸ªæ—‹è½¬çŸ©é˜µï¼Œç„¶åå°†è¿™ä¸ªåæ ‡å’Œè¿™ä¸ªæ—‹è½¬çŸ©é˜µç›¸ä¹˜ï¼Œå®Œæˆæ—‹è½¬å˜æ¢ï¼›</span></span><br><span class="line"><span class="comment">    3. æœ€åå¯¹äºå¹³ç§»ï¼Œæˆ‘ä»¬åŒæ ·å¯ä»¥æ„é€ ä¸€ä¸ªå¹³ç§»çŸ©é˜µï¼Œç„¶åç›¸ä¹˜å°±è¡Œï¼Œå®Œæˆå¹³ç§»å˜æ¢ï¼›</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    æƒ³ä¸èµ·æ¥çš„å¯ä»¥å›é¡¾ä¸€ä¸‹è¿™é‡Œï¼šhttp://fjbq-blog.top/2023/12/30/GAMES%20101%20%E9%9A%8F%E7%AC%94/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†è§’åº¦è½¬æ¢ä¸ºå¼§åº¦</span></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">DegToRad</span><span class="params">(<span class="type">double</span> Deg)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> Deg / <span class="number">180.0</span> * M_PI;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">solve</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// (2,1) çš„ç‚¹çš„é½æ¬¡åæ ‡è¡¨ç¤ºï¼ˆ3 x 1 çš„çŸ©é˜µï¼‰</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">Point</span><span class="params">(<span class="number">2.0</span>, <span class="number">1.0</span>, <span class="number">1.0</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ—‹è½¬å˜æ¢</span></span><br><span class="line">    <span class="type">double</span> Deg = <span class="number">45.0</span>;</span><br><span class="line">    <span class="type">double</span> Rad = <span class="built_in">DegToRad</span>(Deg);</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix3f RotationMatrix;</span><br><span class="line">    RotationMatrix  &lt;&lt;  <span class="built_in">cos</span>(Rad), -<span class="built_in">sin</span>(Rad), <span class="number">0</span>,</span><br><span class="line">                        <span class="built_in">sin</span>(Rad), <span class="built_in">cos</span>(Rad), <span class="number">0</span>,</span><br><span class="line">                        <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    Point = RotationMatrix * Point;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;æ—‹è½¬å˜æ¢ä¹‹åï¼š\n&quot;</span> &lt;&lt; Point &lt;&lt; <span class="string">&quot;\n\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¹³ç§»å˜æ¢</span></span><br><span class="line">    <span class="type">double</span> tx = <span class="number">1.0</span>;</span><br><span class="line">    <span class="type">double</span> ty = <span class="number">2.0</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix3f TranslationMatrix;</span><br><span class="line">    TranslationMatrix &lt;&lt;    <span class="number">1</span>, <span class="number">0</span>, tx,</span><br><span class="line">                            <span class="number">0</span>, <span class="number">1</span>, ty,</span><br><span class="line">                            <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    Point = TranslationMatrix * Point;</span><br><span class="line">    cout &lt;&lt; <span class="string">&quot;æœ€ç»ˆç»“æœï¼š\n&quot;</span> &lt;&lt; Point &lt;&lt;<span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="built_in">solve</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/00/00.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/27/games101/HomeWork%200/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 4ï¼šBÃ©zier æ›²çº¿</title>
      <link>http://example.com/2024/01/27/games101/HomeWork%204/</link>
      <guid>http://example.com/2024/01/27/games101/HomeWork%204/</guid>
      <pubDate>Sat, 27 Jan 2024 15:26:46 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-4ï¼šBezier-æ›²çº¿&quot;&gt;&lt;a href=&quot;#HomeWork-4ï¼šBezier-æ›²çº¿&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 4ï¼šBÃ©zier æ›²çº¿&quot;&gt;&lt;/a&gt;HomeWork 4ï¼šBÃ©zier æ›²çº¿&lt;/h1&gt;&lt;</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-4ï¼šBezier-æ›²çº¿"><a href="#HomeWork-4ï¼šBezier-æ›²çº¿" class="headerlink" title="HomeWork 4ï¼šBÃ©zier æ›²çº¿"></a>HomeWork 4ï¼šBÃ©zier æ›²çº¿</h1><p>è¿™ä¸ªæŒºç®€å•çš„ï¼ŒæŒºæœ‰æ„æ€çš„ï¼š</p><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¥—å…¬å¼æ±‚çš„ è´å¡å°” æ›²çº¿</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">naive_bezier</span><span class="params">(<span class="type">const</span> std::vector&lt;cv::Point2f&gt; &amp;points, cv::Mat &amp;window)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> &amp;p_0 = points[<span class="number">0</span>];</span><br><span class="line">    <span class="keyword">auto</span> &amp;p_1 = points[<span class="number">1</span>];</span><br><span class="line">    <span class="keyword">auto</span> &amp;p_2 = points[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">auto</span> &amp;p_3 = points[<span class="number">3</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">double</span> t = <span class="number">0.0</span>; t &lt;= <span class="number">1.0</span>; t += <span class="number">0.001</span>) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">auto</span> point = std::<span class="built_in">pow</span>(<span class="number">1</span> - t, <span class="number">3</span>) * p_0 + <span class="number">3</span> * t * std::<span class="built_in">pow</span>(<span class="number">1</span> - t, <span class="number">2</span>) * p_1 +</span><br><span class="line">                 <span class="number">3</span> * std::<span class="built_in">pow</span>(t, <span class="number">2</span>) * (<span class="number">1</span> - t) * p_2 + std::<span class="built_in">pow</span>(t, <span class="number">3</span>) * p_3;</span><br><span class="line"></span><br><span class="line">        window.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(point.y, point.x)[<span class="number">2</span>] = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// é€’å½’åšæ³•çš„è´å¡å°”æ›²çº¿</span></span><br><span class="line"><span class="function">cv::Point2f <span class="title">recursive_bezier</span><span class="params">(<span class="type">const</span> std::vector&lt;cv::Point2f&gt; &amp;control_points, <span class="type">float</span> t)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// åªå‰©ä¸€ä¸ªæ§åˆ¶ç‚¹çš„æ—¶å€™å°±èƒ½è¿”å›äº†</span></span><br><span class="line">    <span class="keyword">if</span>(control_points.<span class="built_in">size</span>() == <span class="number">1</span>) <span class="keyword">return</span> control_points[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    std::vector&lt;cv::Point2f&gt; temp_control_points;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; control_points.<span class="built_in">size</span>()<span class="number">-1</span>; i ++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œçœ‹ç€å›¾æ¨ä¸€ä¸‹å°±è¡Œ</span></span><br><span class="line">        cv::Point2f temp_point = control_points[i] - (control_points[i] - control_points[i+<span class="number">1</span>]) * t;</span><br><span class="line">        temp_control_points.<span class="built_in">push_back</span>(temp_point);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">recursive_bezier</span>(temp_control_points, t);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å®ç°ç»˜åˆ¶ BÃ©zier æ›²çº¿çš„åŠŸèƒ½ï¼ˆä¼ è¿›æ¥ä¸€ç»„æ§åˆ¶ç‚¹ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bezier</span><span class="params">(<span class="type">const</span> std::vector&lt;cv::Point2f&gt; &amp;control_points, cv::Mat &amp;window)</span> </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 1000 ä¸ª t</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">float</span> t = <span class="number">0</span>; t &lt;= <span class="number">1</span>; t += <span class="number">0.001f</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::Point2f point = <span class="built_in">recursive_bezier</span>(control_points, t);</span><br><span class="line">        window.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(point.y, point.x)[<span class="number">1</span>] = <span class="number">255</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä¸‹é¢æ˜¯è´å¡å°”æ›²çº¿ï¼š</strong><br><strong>çº¢è‰²ï¼šå…¬å¼</strong><br><strong>ç»¿è‰²ï¼šé€’å½’</strong><br><strong>é»„è‰²ï¼šä¸¤ä¸ªåŒæ—¶è°ƒç”¨çš„ç»“æœ</strong></p><p><img src="/images/Games101/homework/04/01.png"></p><p><img src="/images/Games101/homework/04/02.png"></p><p><img src="/images/Games101/homework/04/03.png"></p><p><strong>æé«˜ï¼šï¼ˆåèµ°æ ·ï¼‰</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    åšä¸€ä¸‹åèµ°æ ·</span></span><br><span class="line"><span class="comment">    https://zhuanlan.zhihu.com/p/464122963</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">bezier_2</span><span class="params">(<span class="type">const</span> std::vector&lt;cv::Point2f&gt; &amp;control_points, cv::Mat &amp;window)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">float</span> t = <span class="number">0.0</span>; t &lt;= <span class="number">1.0</span>; t += <span class="number">0.001</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cv::Point2f point = <span class="built_in">recursive_bezier</span>(control_points, t);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±‚è·ç¦»ç‚¹ point æœ€è¿‘çš„å››ä¸ªåƒç´ çš„åƒç´ äº¤ç‚¹ä¸­å¿ƒï¼ˆå…¶å®å°±æ˜¯å³ä¸‹è§’çš„åƒç´ çš„èµ·ç‚¹ï¼‰</span></span><br><span class="line">        cv::Point2i p0;</span><br><span class="line">        p0.x = point.x-std::<span class="built_in">floor</span>(point.x) &lt; <span class="number">0.5</span> ? std::<span class="built_in">floor</span>(point.x) : std::<span class="built_in">ceil</span>(point.x);</span><br><span class="line">        p0.y = point.y-std::<span class="built_in">floor</span>(point.y) &lt; <span class="number">0.5</span> ? std::<span class="built_in">floor</span>(point.y) : std::<span class="built_in">ceil</span>(point.y);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç‚¹ point æœ€è¿‘çš„å››ä¸ªåƒç´ ç‚¹çš„èµ·ç‚¹</span></span><br><span class="line">        std::vector&lt;cv::Point2i&gt; ps;</span><br><span class="line">        ps.<span class="built_in">push_back</span>(p0);</span><br><span class="line">        ps.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2i</span>(p0.x<span class="number">-1</span>, p0.y));</span><br><span class="line">        ps.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2i</span>(p0.x, p0.y<span class="number">-1</span>));</span><br><span class="line">        ps.<span class="built_in">push_back</span>(cv::<span class="built_in">Point2i</span>(p0.x<span class="number">-1</span>, p0.y<span class="number">-1</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç‚¹ p åˆ°ç›¸é‚»å››ä¸ªç‚¹çš„ä¸­å¿ƒç‚¹çš„è·ç¦»</span></span><br><span class="line">        <span class="type">float</span> sum_d = <span class="number">0.0f</span>;</span><br><span class="line">        <span class="type">float</span> max_d = <span class="built_in">sqrt</span>(<span class="number">2</span>);</span><br><span class="line">        std::vector&lt;<span class="type">float</span>&gt; ds = &#123;&#125;;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// åƒç´ ç‚¹çš„ä¸­å¿ƒ</span></span><br><span class="line">            <span class="function">cv::Point2f <span class="title">cp</span><span class="params">(ps[i].x + <span class="number">0.5f</span>, ps[i].y + <span class="number">0.5f</span>)</span></span>;</span><br><span class="line">            <span class="type">float</span> d = max_d - std::<span class="built_in">sqrt</span>(std::<span class="built_in">pow</span>(point.x - cp.x, <span class="number">2</span>) + std::<span class="built_in">pow</span>(point.y - cp.y, <span class="number">2</span>));</span><br><span class="line">            ds.<span class="built_in">push_back</span>(d);</span><br><span class="line">            sum_d += d;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±‚ä¸€ä¸‹åŠ æƒçš„é¢œè‰²ç›´å°±è¡Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">4</span>; i++) </span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">float</span> k = ds[i] / sum_d;</span><br><span class="line">            window.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(ps[i].y, ps[i].x)[<span class="number">1</span>] = std::<span class="built_in">min</span>(<span class="number">255.f</span>, window.<span class="built_in">at</span>&lt;cv::Vec3b&gt;(ps[i].y, ps[i].x)[<span class="number">1</span>] + <span class="number">255.f</span> * k);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>åèµ°æ ·å¯¹æ¯”ï¼Œæ•ˆæœè¿˜æ˜¯æŒºæ˜æ˜¾çš„ï¼š</strong></p><p><img src="/images/Games101/homework/04/04.png"></p><p><img src="/images/Games101/homework/04/05.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/27/games101/HomeWork%204/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 3ï¼šPipeline and Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰</title>
      <link>http://example.com/2024/01/27/games101/HomeWork%203/</link>
      <guid>http://example.com/2024/01/27/games101/HomeWork%203/</guid>
      <pubDate>Sat, 27 Jan 2024 15:26:46 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-3ï¼šPipeline-and-Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰&quot;&gt;&lt;a href=&quot;#HomeWork-3ï¼šPipeline-and-Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 3ï¼šPipel</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-3ï¼šPipeline-and-Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰"><a href="#HomeWork-3ï¼šPipeline-and-Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰" class="headerlink" title="HomeWork 3ï¼šPipeline and Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰"></a>HomeWork 3ï¼šPipeline and Shadingï¼ˆæ¸²æŸ“å°å¥¶ç‰›ï¼‰</h1><p>è¿™æ¬¡ä½œä¸šæ˜¯æ¸²æŸ“å°å¥¶ç‰›ï¼Œæœ‰ æ³•çº¿ï¼ŒBinne-Pongï¼Œçº¹ç†è´´å›¾ï¼Œå‡¹å‡¸è´´å›¾ï¼Œä½ç§»è´´å›¾ï¼›</p><p>è¿™ä¸ªä½œä¸šå¥½å¤šå‘€ï¼Œæ„Ÿè§‰æŒºéš¾çš„â€¦</p><p>å¾—å‚è€ƒè¿™å‡ ç¯‡æ–‡ç« ï¼š</p><p><a href="http://fjbq-blog.top/2024/01/07/games101/Lec%2007/">ã€Games 101ã€‘Lec 07ï¼šæ¸²æŸ“1ï¼ˆå…‰ç…§ é˜´å½± å’Œ å›¾å½¢ç®¡çº¿ï¼‰</a></p><p><a href="http://fjbq-blog.top/2024/01/07/games101/Lec%2008/">ã€Games 101ã€‘Lec 08ï¼šæ¸²æŸ“2ï¼ˆé˜´å½± æ¸²æŸ“ç®¡çº¿ å’Œ çº¹ç†æ˜ å°„ï¼‰</a></p><p><a href="http://fjbq-blog.top/2024/01/07/games101/Lec%2009/">ã€Games 101ã€‘Lec 09ï¼šæ¸²æŸ“3ï¼ˆçº¹ç†æ˜ å°„ï¼ˆç»­ï¼‰ï¼‰</a></p><h2 id="æ³•çº¿"><a href="#æ³•çº¿" class="headerlink" title="æ³•çº¿"></a>æ³•çº¿</h2><p>é¦–å…ˆå®ç°ä¸€ä¸ªæ³•çº¿çš„ï¼š</p><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–æŠ•å½±çŸ©é˜µï¼ˆç›´æ¥æ¬å‰é¢çš„å°±è¡Œï¼‰</span></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€è§†æŠ•å½±å‹ç¼©çŸ©é˜µ</span></span><br><span class="line">    Eigen::Matrix4f M_persp;</span><br><span class="line">    M_persp &lt;&lt;  zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear*zFar,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹æ­£äº¤æŠ•å½±çŸ©é˜µè¦ç”¨åˆ°çš„å‚æ•°</span></span><br><span class="line">    <span class="type">float</span> alpha = <span class="number">0.5</span> * (eye_fov / <span class="number">180.0f</span> * MY_PI);     <span class="comment">// è§†é‡è§’åº¦çš„ä¸€åŠ</span></span><br><span class="line">    <span class="type">float</span> yTop = -zNear * <span class="built_in">tan</span>(alpha);              <span class="comment">// å› ä¸ºè¿™é‡Œçš„zç»™çš„æ˜¯è´Ÿæ•°ï¼Œæ‰€ä»¥åŠ è´Ÿå·ä¹‹åå†è½¬æ¢</span></span><br><span class="line">    <span class="type">float</span> yBottom = -yTop;</span><br><span class="line">    <span class="type">float</span> xRight = yTop * aspect_ratio;                 <span class="comment">// aspect_ratio æ˜¯ xy çš„æ¯”ä¾‹</span></span><br><span class="line">    <span class="type">float</span> xLeft = -xRight;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f M_trans;</span><br><span class="line">    M_trans &lt;&lt;  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(xLeft + xRight) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(yTop + yBottom) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(zNear + zFar) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f M_ortho;</span><br><span class="line">    M_ortho &lt;&lt;  <span class="number">2</span> / (xRight - xLeft), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">2</span> / (yTop - yBottom), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (zNear - zFar), <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå°±æ˜¯ æ­£äº¤æŠ•å½±çŸ©é˜µ</span></span><br><span class="line">    M_ortho = M_ortho * M_trans;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€è§†æŠ•å½±çŸ©é˜µ = æ­£äº¤æŠ•å½±çŸ©é˜µ * é€è§†å‹ç¼©çŸ©é˜µï¼ˆæ³¨æ„é¡ºåºå“¦ï¼‰</span></span><br><span class="line">    projection = M_ortho * M_persp * projection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>rasterizer.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    ä¸‰è§’å½¢å…‰æ …åŒ–</span></span><br><span class="line"><span class="comment">    view_pos æ˜¯ä¸‰è§’å½¢ä¸‰ä¸ªé¡¶ç‚¹çš„è¯•å›¾åæ ‡ï¼Œè§†å›¾åæ ‡æ˜¯æŒ‡ç›¸æœºç©ºé—´ï¼ˆæˆ–è§‚å¯Ÿç©ºé—´ï¼‰ä¸­çš„åæ ‡ï¼Œå³ç›¸å¯¹äºç›¸æœºçš„åæ ‡ã€‚</span></span><br><span class="line"><span class="comment">    ä»¥æ”¯æŒåœ¨å±å¹•ç©ºé—´å†…è¿›è¡Œæ’å€¼å’Œæ¸²æŸ“</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">rasterize_triangle</span>(<span class="type">const</span> Triangle&amp; t, <span class="type">const</span> std::array&lt;Eigen::Vector3f, <span class="number">3</span>&gt;&amp; view_pos) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = t.<span class="built_in">toVector4</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> min_x = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_x = INT_MIN;</span><br><span class="line">    <span class="type">int</span> min_y = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_y = INT_MIN;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹ä¸‰è§’å½¢çš„åŒ…å›´ç›’</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> point : v) <span class="comment">//è·å–åŒ…å›´ç›’è¾¹ç•Œ</span></span><br><span class="line">    &#123;</span><br><span class="line">        min_x = <span class="built_in">min</span>((<span class="type">float</span>)min_x, point[<span class="number">0</span>]);</span><br><span class="line">        max_x = <span class="built_in">max</span>((<span class="type">float</span>)max_x, point[<span class="number">0</span>]);</span><br><span class="line">        min_y = <span class="built_in">min</span>((<span class="type">float</span>)min_y, point[<span class="number">1</span>]);</span><br><span class="line">        max_y = <span class="built_in">max</span>((<span class="type">float</span>)max_y, point[<span class="number">1</span>]);</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†åŒ…å›´ç›’é‡Œé¢çš„ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = min_y; y &lt;= max_y; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = min_x; x &lt;= max_x; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">insideTriangle</span>((<span class="type">float</span>)x+<span class="number">0.5</span>, (<span class="type">float</span>)y+<span class="number">0.5</span>, t.v))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// æ±‚ä¸€ä¸‹ä¸‰è§’å½¢é‡å¿ƒåæ ‡</span></span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = <span class="built_in">computeBarycentric2D</span>(x+<span class="number">0.5</span>, y+<span class="number">0.5</span>, t.v);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// æ±‚ä¸€ä¸‹æ·±åº¦</span></span><br><span class="line">                <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma / v[<span class="number">2</span>].<span class="built_in">w</span>());</span><br><span class="line">                <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].<span class="built_in">z</span>() / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta * v[<span class="number">1</span>].<span class="built_in">z</span>() / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma * v[<span class="number">2</span>].<span class="built_in">z</span>() / v[<span class="number">2</span>].<span class="built_in">w</span>();</span><br><span class="line">                z_interpolated *= w_reciprocal;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åˆ¤æ–­å½“å‰zå€¼æ˜¯å¦å°äºåŸæ¥zè¡¨æ­¤ä½ç½®çš„zå€¼</span></span><br><span class="line">                <span class="keyword">if</span> (z_interpolated &lt; depth_buf[<span class="built_in">get_index</span>(x, y)]) </span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// é¢œè‰²æ’å€¼</span></span><br><span class="line">                    <span class="keyword">auto</span> interpolated_color = <span class="built_in">interpolate</span>(alpha, beta, gamma, t.color[<span class="number">0</span>], t.color[<span class="number">1</span>], t.color[<span class="number">2</span>], <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// æ³•çº¿æ’å€¼(éœ€è¦å½’ä¸€åŒ– .normalized())</span></span><br><span class="line">                    <span class="keyword">auto</span> interpolated_normal = <span class="built_in">interpolate</span>(alpha, beta, gamma, t.normal[<span class="number">0</span>], t.normal[<span class="number">1</span>], t.normal[<span class="number">2</span>], <span class="number">1.0f</span>).<span class="built_in">normalized</span>();</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// çº¹ç†æ’å€¼</span></span><br><span class="line">                    <span class="keyword">auto</span> interpolated_texcoords = <span class="built_in">interpolate</span>(alpha, beta, gamma, t.tex_coords[<span class="number">0</span>], t.tex_coords[<span class="number">1</span>], t.tex_coords[<span class="number">2</span>], <span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// è§†å›¾åæ ‡æ’å€¼</span></span><br><span class="line">                    <span class="keyword">auto</span> interpolated_shadingcoords = <span class="built_in">interpolate</span>(alpha,beta,gamma,view_pos[<span class="number">0</span>],view_pos[<span class="number">1</span>],view_pos[<span class="number">2</span>],<span class="number">1.0f</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// ç”¨ä¸€ä¸ªç»“æ„ä½“å­˜ä¸€ä¸‹</span></span><br><span class="line">                    <span class="function">fragment_shader_payload <span class="title">payload</span><span class="params">( interpolated_color, interpolated_normal.normalized(), interpolated_texcoords, texture ? &amp;*texture : <span class="literal">nullptr</span>)</span></span>;</span><br><span class="line">                    payload.view_pos = interpolated_shadingcoords;</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// ä¼ ç»™ç‰‡æ®µç€è‰²å™¨ï¼Œè·å–æœ€ç»ˆé¢œè‰²</span></span><br><span class="line">                    <span class="keyword">auto</span> pixel_color = <span class="built_in">fragment_shader</span>(payload);</span><br><span class="line">                    </span><br><span class="line">                    <span class="comment">// æ›´æ–°æ·±åº¦ç¼“å­˜ï¼Œå¹¶è®¾ç½®åƒç´ çš„é¢œè‰²</span></span><br><span class="line">                    depth_buf[<span class="built_in">get_index</span>(x,y)] = z_interpolated;</span><br><span class="line">                    <span class="built_in">set_pixel</span>(<span class="built_in">Vector2i</span>(x,y),pixel_color);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±èƒ½æŒ‰ç…§ pdf é‡Œé¢çš„æ“ä½œè¿è¡Œå•¦ï¼Œç»“æœå¦‚ä¸‹ï¼š</p><p><img src="/images/Games101/homework/03/01.png"></p><h2 id="Binne-Pong"><a href="#Binne-Pong" class="headerlink" title="Binne-Pong"></a>Binne-Pong</h2><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Blinn-Phong ç‰‡æ®µæ¸²æŸ“å™¨</span></span><br><span class="line"><span class="comment">    Blinn-Phong æ¨¡å‹ = ç¯å¢ƒåå°„ + æ¼«åå°„æ¨¡å‹ + é«˜å…‰åå°„/é•œé¢åå°„</span></span><br><span class="line"><span class="comment">    æ€»ç»“ï¼šè¾¹çœ‹ç¬”è®°çš„å…¬å¼è¾¹å†™å°±è¡Œï¼ˆä¸»è¦æ˜¯å¾—ææ¸…æ¥šä»£ç é‡Œé¢çš„æ¯ä¸ªå˜é‡åˆ°åº•æ˜¯å•¥ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">phong_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// Ambient ç¯å¢ƒåå°„çš„ç³»æ•°</span></span><br><span class="line">    Eigen::Vector3f ka = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    <span class="comment">// Diffuse æ¼«åå°„ç³»æ•°</span></span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    <span class="comment">// Specular é«˜å…‰åå°„</span></span><br><span class="line">    Eigen::Vector3f ks = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ä¸¤ä¸ªå…‰æº</span></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    std::vector&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç¯å¢ƒåå°„çš„ Iaï¼ˆä¹Ÿæ˜¯å°±ç¯å¢ƒå…‰çš„å¼ºåº¦ï¼‰</span></span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§†ç‚¹</span></span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡æ•° p çš„ä¸€ä¸ªä½œç”¨ï¼šæ§åˆ¶é«˜å…‰çš„è¡°å‡å¤§å°ï¼ˆå¯ä»¥åœ¨ç¬”è®°ä¸­æœç´¢è¿™å¥è¯ï¼‰</span></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¡¨é¢çš„ é¢œè‰²ï¼Œè§†å›¾ä½ç½®ï¼Œæ³•çº¿</span></span><br><span class="line">    Eigen::Vector3f color = payload.color;</span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ€ç»ˆçš„å…‰</span></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ ç¯å¢ƒåå°„ï¼Œæ¼«åå°„ï¼Œé«˜å…‰åå°„</span></span><br><span class="line">    Eigen::Vector3f ambient=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f diffuse=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f specular=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äºæ¯æ¡å…‰çº¿ï¼Œè®¡ç®— æ¼«åå°„ å’Œ é«˜å…‰åå°„ï¼ˆç¯å¢ƒå…‰å§‹ç»ˆä¸å˜ï¼Œæœ€ååŠ ä¸Šå»å°±è¡Œï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            è®¡ç®—æ¼«åå°„</span></span><br><span class="line"><span class="comment">            - light.intensityï¼šæ˜¯å…‰å¼ºï¼Œä¹Ÿå°±æ˜¯å…¬å¼ä¸­çš„ I</span></span><br><span class="line"><span class="comment">            - r_squaredï¼šç‰©ä½“ä¸å…‰æºè·ç¦»çš„å¹³æ–¹ï¼ˆä¹Ÿå°±æ˜¯å…¬å¼ä¸­çš„ r^2ï¼‰</span></span><br><span class="line"><span class="comment">            - light.position - pointï¼šè¡¨ç¤ºçš„æ˜¯å…‰çº¿åˆ°è¡¨é¢çš„å‘é‡ï¼ˆä¹Ÿå°±æ˜¯å…¬å¼ä¸­çš„ Iï¼Œå¯ä»¥çœ‹ä¸€ä¸‹ &quot;æ¼«åå°„æ¨¡å‹&quot;ï¼‰</span></span><br><span class="line"><span class="comment">            - ä»&quot;æ¼«åå°„æ¨¡å‹&quot;ç¬”è®°é‡Œé¢å¯ä»¥çœ‹åˆ°ï¼Œnormal.dot(((light.position - point).normalized())) è¿™ä¸€é¡¹å°±æ˜¯åœ¨æ±‚ä¸€ä¸ªè§’åº¦</span></span><br><span class="line"><span class="comment">            - cwiseProductï¼šæ˜¯Eigenåº“ä¸­çš„ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºå¯¹ä¸¤ä¸ªå‘é‡è¿›è¡Œé€å…ƒç´ ä¹˜æ³•ã€‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="type">float</span> r_squared=(light.position - point).<span class="built_in">squaredNorm</span>();</span><br><span class="line">        diffuse = kd.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * <span class="built_in">MAX</span>(<span class="number">0</span>, normal.<span class="built_in">dot</span>(((light.position - point).<span class="built_in">normalized</span>())));</span><br><span class="line"></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">            è®¡ç®—é«˜å…‰åå°„</span></span><br><span class="line"><span class="comment">            - hï¼šå…¥å°„ä¸åå°„å…‰çš„åŠç¨‹å‘é‡</span></span><br><span class="line"><span class="comment">            - light.position - pointï¼šè¡¨ç¤ºçš„æ˜¯ å…‰çº¿ åˆ°è¡¨é¢çš„å‘é‡</span></span><br><span class="line"><span class="comment">            - eye_pos - pointï¼šè¡¨ç¤ºçš„æ˜¯ çœ¼ç› åˆ°è¡¨é¢çš„å‘é‡</span></span><br><span class="line"><span class="comment">            - è®¡ç®—é«˜å…‰çš„æ—¶å€™ï¼Œä¸€å®šè¦æ³¨æ„pæ¬¡å¹‚</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">        <span class="comment">// å¥—å…¬å¼</span></span><br><span class="line">        <span class="keyword">auto</span> h = ((light.position - point).<span class="built_in">normalized</span>() + (eye_pos - point).<span class="built_in">normalized</span>()).<span class="built_in">normalized</span>();</span><br><span class="line">        specular = ks.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * std::<span class="built_in">pow</span>(std::<span class="built_in">max</span>(<span class="number">0.0f</span>, normal.<span class="built_in">dot</span>(h)), p); </span><br><span class="line">    </span><br><span class="line">        <span class="comment">// ç¯å¢ƒåå°„ï¼ˆæ”¾å¤–é¢åªç®—ä¸€æ¬¡çš„è¯ï¼Œæ¸²æŸ“å‡ºæ¥çœ‹èµ·æ¥å°±æ¯”è¾ƒæš—ä¸€ç‚¹ï¼‰</span></span><br><span class="line">        ambient = ka.<span class="built_in">cwiseProduct</span>(amb_light_intensity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€ååŠ å’Œä¸€ä¸‹</span></span><br><span class="line">        result_color += (ambient + diffuse + specular);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»“æœï¼š</p><p><img src="/images/Games101/homework/03/02.png"></p><h2 id="çº¹ç†è´´å›¾ï¼ˆtextureï¼‰"><a href="#çº¹ç†è´´å›¾ï¼ˆtextureï¼‰" class="headerlink" title="çº¹ç†è´´å›¾ï¼ˆtextureï¼‰"></a>çº¹ç†è´´å›¾ï¼ˆtextureï¼‰</h2><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    çº¹ç†ç‰‡æ®µæ¸²æŸ“å™¨</span></span><br><span class="line"><span class="comment">    åœ¨å®ç° Blinn-Phongçš„åŸºç¡€ä¸Š,å°†çº¹ç†é¢œè‰²è§†ä¸ºå…¬å¼ä¸­çš„ kd,å®ç° Texture Shading Fragment Shader.</span></span><br><span class="line"><span class="comment">    - ä½¿ç”¨uvåæ ‡è°ƒç”¨çº¹ç†get_colorå‡½æ•°ã€‚</span></span><br><span class="line"><span class="comment">    - uvåæ ‡æ˜¯rasterize_triangleå‡½æ•°ä¸­æ’å€¼å¾—åˆ°çš„ã€‚</span></span><br><span class="line"><span class="comment">    - ç”¨å¯¹åº”ç‚¹çº¹ç†çš„é¢œè‰²æ›¿æ¢æ¼«åå°„kdç³»æ•°ã€‚</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">texture_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> Limit_Number = [](<span class="type">float</span> &amp;number)&#123;</span><br><span class="line">        number = <span class="built_in">max</span>(number, (<span class="type">float</span>)<span class="number">0.0</span>);</span><br><span class="line">        number = <span class="built_in">min</span>(number, (<span class="type">float</span>)<span class="number">1.0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f return_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">if</span> (payload.texture)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// çº¹ç†åæ ‡ u vï¼ˆåº”è¯¥åœ¨ [0,1] ä¹‹é—´ï¼Œé™åˆ¶ä¸€ä¸‹ï¼Œé¿å…è¶Šç•Œï¼‰</span></span><br><span class="line">        <span class="type">float</span> u = payload.tex_coords.<span class="built_in">x</span>();</span><br><span class="line">        <span class="type">float</span> v = payload.tex_coords.<span class="built_in">y</span>();</span><br><span class="line">        <span class="built_in">Limit_Number</span>(u);</span><br><span class="line">        <span class="built_in">Limit_Number</span>(v);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è·å–å¯¹åº”çº¹ç†åæ ‡çš„é¢œè‰²</span></span><br><span class="line">        return_color = payload.texture-&gt;<span class="built_in">getColor</span>(u, v);</span><br><span class="line">    &#125;</span><br><span class="line">    Eigen::Vector3f texture_color;</span><br><span class="line">    texture_color &lt;&lt; return_color.<span class="built_in">x</span>(), return_color.<span class="built_in">y</span>(), return_color.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ka = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    <span class="comment">// å°†å¯¹åº”ç‚¹çš„çº¹ç†é¢œè‰²æ›¿æ¢æˆæ¼«åå°„kdç³»æ•°</span></span><br><span class="line">    Eigen::Vector3f kd = texture_color / <span class="number">255.f</span>;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = texture_color;</span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸‹é¢ä¹Ÿæ˜¯ä¸€æ ·çš„ Blinn-Phong</span></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f ambient=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f diffuse=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f specular=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¯¹äºæ¯æ¡å…‰çº¿ï¼Œè®¡ç®— æ¼«åå°„ å’Œ é«˜å…‰åå°„ï¼ˆç¯å¢ƒå…‰å§‹ç»ˆä¸å˜ï¼Œæœ€ååŠ ä¸Šå»å°±è¡Œï¼‰</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ¼«åå°„</span></span><br><span class="line">        <span class="type">float</span> r_squared=(light.position - payload.view_pos).<span class="built_in">squaredNorm</span>();</span><br><span class="line">        diffuse = kd.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * <span class="built_in">MAX</span>(<span class="number">0</span>, normal.<span class="built_in">dot</span>(((light.position - point).<span class="built_in">normalized</span>())));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é«˜å…‰åå°„</span></span><br><span class="line">        <span class="keyword">auto</span> h = ((light.position - point).<span class="built_in">normalized</span>() + (eye_pos - point).<span class="built_in">normalized</span>()).<span class="built_in">normalized</span>();</span><br><span class="line">        specular = ks.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * std::<span class="built_in">pow</span>(std::<span class="built_in">max</span>(<span class="number">0.0f</span>, normal.<span class="built_in">dot</span>(h)), p); </span><br><span class="line">    </span><br><span class="line">        <span class="comment">// ç¯å¢ƒåå°„ï¼ˆæ”¾å¤–é¢åªç®—ä¸€æ¬¡çš„è¯ï¼Œæ¸²æŸ“å‡ºæ¥çœ‹èµ·æ¥å°±æ¯”è¾ƒæš—ä¸€ç‚¹ï¼‰</span></span><br><span class="line">        ambient = ka.<span class="built_in">cwiseProduct</span>(amb_light_intensity);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æœ€ååŠ å’Œä¸€ä¸‹</span></span><br><span class="line">        result_color += (ambient + diffuse + specular);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/03/03.png"></p><h2 id="å‡¹å‡¸è´´å›¾ï¼ˆBump-Mappingï¼‰"><a href="#å‡¹å‡¸è´´å›¾ï¼ˆBump-Mappingï¼‰" class="headerlink" title="å‡¹å‡¸è´´å›¾ï¼ˆBump Mappingï¼‰"></a>å‡¹å‡¸è´´å›¾ï¼ˆBump Mappingï¼‰</h2><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Bump Mapping ç‰‡æ®µæ¸²æŸ“å™¨ï¼ˆå‡¹å‡¸è´´å›¾ï¼‰</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªå¥½éš¾ï¼Œå»ºè®®å›å»çœ‹çœ‹è§†é¢‘ï¼ˆP10 å‰åŠéƒ¨åˆ†ï¼‰</span></span><br><span class="line"><span class="comment">    å†ç»“åˆTBNçŸ©é˜µçš„æ±‚æ³•å’Œåº”ç”¨ã€‚</span></span><br><span class="line"><span class="comment">    TBN çŸ©é˜µå°±æ˜¯ä¸–ç•Œç©ºé—´åˆ°åˆ‡çº¿ç©ºé—´ä¹‹é—´äº’ç›¸è½¬å˜çš„æ¡¥æ¢ï¼š</span></span><br><span class="line"><span class="comment">        - ä¸–ç•Œç©ºé—´ = TBNçŸ©é˜µçš„é€† x åˆ‡çº¿ç©ºé—´</span></span><br><span class="line"><span class="comment">        - åˆ‡çº¿ç©ºé—´ = TBNçŸ©é˜µ x ä¸–ç•Œç©ºé—´</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    ç…§ç€TODOé‡Œé¢å†™</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    -- 2024.02.07 [fjbq]</span></span><br><span class="line"><span class="comment">    è¿™é‡Œéœ€è¦ç‰¹åˆ«çš„æ³¨æ„è¿™ä¸ª [åˆ‡çº¿ç©ºé—´/æ³•çº¿è´´å›¾çš„ç†è§£] å’Œ [TBN çŸ©é˜µçš„è¿ç”¨] !!!</span></span><br><span class="line"><span class="comment">    æˆ‘å‘ç°ä¹‹å‰ç†è§£çš„æœ‰ç‚¹é—®é¢˜ï¼Œä¸å¤ªæ·±åˆ»ï¼Œåé¢åœ¨å¤åˆ» tinyrenderer çš„æ—¶å€™å‘ç°è¿™ä¸ªé—®é¢˜ï¼</span></span><br><span class="line"><span class="comment">    å…·ä½“çœ‹è¿™é‡Œï¼Œè¿™é‡Œè®²çš„æ¯”è¾ƒæ¸…æ¥šï¼šhttps://blog.csdn.net/game_jqd/article/details/74858146</span></span><br><span class="line"><span class="comment">    ç„¶åæ”¹äº†ä¸€ä¸‹ä¸Šé¢ ä¸–ç•Œç©ºé—´ å’Œ åˆ‡çº¿ç©ºé—´ çš„è½¬æ¢å…¬å¼</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    ç„¶åçœ‹ä¸‹é¢ä»£ç  TBN çŸ©é˜µçš„æ³¨é‡Šï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">    å¯ä»¥çœ‹åˆ°ï¼Œä¸€èˆ¬çš„TBNçŸ©é˜µæ˜¯å…ˆè¡Œå†åˆ—çš„ï¼Œä¹Ÿå°±æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">    TBN &lt;&lt;  t.x(), t.y(), t.z(),</span></span><br><span class="line"><span class="comment">            b.x(), b.y(), b.z(),</span></span><br><span class="line"><span class="comment">            n.x(), n.y(), n.z();</span></span><br><span class="line"><span class="comment">    ä½†æ˜¯æˆ‘ä»¬å‘ç°ä»£ç é‡Œé¢ç«Ÿç„¶æ˜¯ï¼š</span></span><br><span class="line"><span class="comment">    TBN &lt;&lt;  t.x(), b.x(), n.x(),</span></span><br><span class="line"><span class="comment">            t.y(), b.y(), n.y(),</span></span><br><span class="line"><span class="comment">            t.z(), b.z(), n.z();</span></span><br><span class="line"><span class="comment">    ä¹Ÿå°±æ˜¯è¯´å®ƒè½¬ç½®äº†ä¸€ä¸‹ï¼</span></span><br><span class="line"><span class="comment">    åŒæ—¶ï¼ŒTBNçŸ©é˜µæ˜¯ä¸€ä¸ªæ­£äº¤çŸ©é˜µï¼Œå®ƒçš„é€†ç­‰äºå®ƒçš„è½¬ç½®ï¼›</span></span><br><span class="line"><span class="comment">    é‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´ä¸‹é¢ä»£ç çš„TBNçŸ©é˜µå…¶å®æ˜¯å°†åŸæ¥çš„TBNçŸ©é˜µæ±‚é€†äº†ï¼ï¼ï¼</span></span><br><span class="line"><span class="comment">    </span></span><br><span class="line"><span class="comment">    æ‰€ä»¥è¿™ä¸‹å°±æ²¡é—®é¢˜äº†ï¼š</span></span><br><span class="line"><span class="comment">    é¦–å…ˆæ³•çº¿è´´å›¾é‡Œé¢å­˜çš„éƒ½æ˜¯åˆ‡çº¿ç©ºé—´ä¸­çš„æ³•çº¿ï¼Œ</span></span><br><span class="line"><span class="comment">    è€Œæˆ‘ä»¬è®¡ç®—å…‰ç…§ç”¨åˆ°çš„æ³•çº¿éœ€è¦ç»Ÿä¸€åˆ°ä¸–ç•Œç©ºé—´ä¸­æ¥ï¼Œ</span></span><br><span class="line"><span class="comment">    æ‰€ä»¥éœ€è¦è½¬æ¢ä¸€ä¸‹ï¼š</span></span><br><span class="line"><span class="comment">        ä¸–ç•Œç©ºé—´ = TBNçŸ©é˜µçš„é€† x åˆ‡çº¿ç©ºé—´</span></span><br><span class="line"><span class="comment">    -- 2024.02.07 [fjbq]</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">bump_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> Limit_Number = [](<span class="type">float</span> &amp;number)&#123;</span><br><span class="line">        number = <span class="built_in">max</span>(number, (<span class="type">float</span>)<span class="number">0.0</span>);</span><br><span class="line">        number = <span class="built_in">min</span>(number, (<span class="type">float</span>)<span class="number">1.0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è¿™é‡Œ .norm æ±‚èŒƒæ•°ï¼›</span></span><br><span class="line"><span class="comment">        è¿™é‡Œå·¨å‘...</span></span><br><span class="line"><span class="comment">        è¿™é‡Œ u v ä¼šå¤§äº1...</span></span><br><span class="line"><span class="comment">        å¯¼è‡´ getColor(u, v) çš„æ—¶å€™ä¼šæ•°ç»„è¶Šç•Œ...æ‰€ä»¥éœ€è¦é™åˆ¶ä¸€ä¸‹</span></span><br><span class="line"><span class="comment">        è°ƒäº†ä¸€ä¸‹åˆäº†...</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">auto</span> func_h = [&amp;payload, Limit_Number](<span class="type">float</span> u, <span class="type">float</span> v) -&gt; <span class="keyword">auto</span> &#123;</span><br><span class="line">        <span class="built_in">Limit_Number</span>(u);</span><br><span class="line">        <span class="built_in">Limit_Number</span>(v);</span><br><span class="line">        <span class="keyword">return</span> payload.texture-&gt;<span class="built_in">getColor</span>(u, v).<span class="built_in">norm</span>();</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ³¨æ„è¿™é‡Œ payload å…³è”çš„è´´å›¾åº”è¯¥æ˜¯å‡¹å‡¸è´´å›¾</span></span><br><span class="line">    Eigen::Vector3f ka = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// næ˜¯åŸæ¥æ¨¡å‹ç©ºé—´çš„æ³•çº¿</span></span><br><span class="line">    Eigen::Vector3f n = normal;</span><br><span class="line">    <span class="type">float</span> x = n.<span class="built_in">x</span>(), y = n.<span class="built_in">y</span>(), z = n.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å¾—åˆ°æ³•çº¿ç©ºé—´çš„åŸºå‘é‡tå’Œb(æ³•çº¿ç©ºé—´ä¸­ï¼Œnä¸æ¨¡å‹ç©ºé—´ä¸€è‡´)</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">t</span><span class="params">(x*y / sqrt(x*x + z*z), sqrt(x*x + z*z), z*y / sqrt(x*x + z*z))</span></span>;</span><br><span class="line">    Eigen::Vector3f b = n.<span class="built_in">cross</span>(t);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªæ˜¯ TBNçŸ©é˜µ çš„é€†ï¼ï¼ï¼: å°†çº¹ç†åæ ‡å¯¹åº”åˆ°æ¨¡å‹ç©ºé—´ä¸­</span></span><br><span class="line">    Eigen::Matrix3f TBN; </span><br><span class="line">    TBN &lt;&lt;  t.<span class="built_in">x</span>(), b.<span class="built_in">x</span>(), n.<span class="built_in">x</span>(),</span><br><span class="line">            t.<span class="built_in">y</span>(), b.<span class="built_in">y</span>(), n.<span class="built_in">y</span>(),</span><br><span class="line">            t.<span class="built_in">z</span>(), b.<span class="built_in">z</span>(), n.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡å’Œå¤§å°</span></span><br><span class="line">    <span class="type">float</span> u = payload.tex_coords.<span class="built_in">x</span>(), v = payload.tex_coords.<span class="built_in">y</span>();</span><br><span class="line">    <span class="type">float</span> w = payload.texture-&gt;width, h = payload.texture-&gt;height;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (<span class="built_in">func_h</span>(u+<span class="number">1</span>/w, v) - <span class="built_in">func_h</span>(u,v));</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (<span class="built_in">func_h</span>(u, v+<span class="number">1</span>/h) - <span class="built_in">func_h</span>(u,v));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—åˆ‡çº¿ç©ºé—´ä¸­æ³•çº¿çš„åæ ‡</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">ln</span><span class="params">(-dU, -dV, <span class="number">1</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®ƒè½¬æ¢åˆ°æ¨¡å‹ç©ºé—´ä¸­</span></span><br><span class="line">    <span class="comment">// ä¸–ç•Œç©ºé—´ = TBNçŸ©é˜µçš„é€† x åˆ‡çº¿ç©ºé—´</span></span><br><span class="line">    normal = (TBN * ln).<span class="built_in">normalized</span>();</span><br><span class="line">    result_color = normal;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/03/04.png"></p><h2 id="ä½ç§»è´´å›¾ï¼ˆDisplacement-Mappingï¼‰"><a href="#ä½ç§»è´´å›¾ï¼ˆDisplacement-Mappingï¼‰" class="headerlink" title="ä½ç§»è´´å›¾ï¼ˆDisplacement Mappingï¼‰"></a>ä½ç§»è´´å›¾ï¼ˆDisplacement Mappingï¼‰</h2><p><strong>main.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    Displacement Mapping ç‰‡æ®µæ¸²æŸ“å™¨ï¼ˆä½ç§»è´´å›¾ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">displacement_fragment_shader</span><span class="params">(<span class="type">const</span> fragment_shader_payload&amp; payload)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">auto</span> Limit_Number = [](<span class="type">float</span> &amp;number)&#123;</span><br><span class="line">        number = <span class="built_in">max</span>(number, (<span class="type">float</span>)<span class="number">0.0</span>);</span><br><span class="line">        number = <span class="built_in">min</span>(number, (<span class="type">float</span>)<span class="number">1.0</span>);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">        è¿™é‡Œ .norm æ±‚èŒƒæ•°ï¼›</span></span><br><span class="line"><span class="comment">        è¿™é‡Œå·¨å‘...</span></span><br><span class="line"><span class="comment">        è¿™é‡Œ u v ä¼šå¤§äº1...</span></span><br><span class="line"><span class="comment">        å¯¼è‡´ getColor(u, v) çš„æ—¶å€™ä¼šæ•°ç»„è¶Šç•Œ...æ‰€ä»¥éœ€è¦é™åˆ¶ä¸€ä¸‹</span></span><br><span class="line"><span class="comment">        è°ƒäº†ä¸€ä¸‹åˆäº†...</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">auto</span> func_h = [&amp;payload, Limit_Number](<span class="type">float</span> u, <span class="type">float</span> v) -&gt; <span class="keyword">auto</span> &#123;</span><br><span class="line">        <span class="built_in">Limit_Number</span>(u);</span><br><span class="line">        <span class="built_in">Limit_Number</span>(v);</span><br><span class="line">        <span class="keyword">return</span> payload.texture-&gt;<span class="built_in">getColor</span>(u, v).<span class="built_in">norm</span>();</span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">    Eigen::Vector3f ka = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.005</span>, <span class="number">0.005</span>, <span class="number">0.005</span>);</span><br><span class="line">    Eigen::Vector3f kd = payload.color;</span><br><span class="line">    Eigen::Vector3f ks = Eigen::<span class="built_in">Vector3f</span>(<span class="number">0.7937</span>, <span class="number">0.7937</span>, <span class="number">0.7937</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">auto</span> l1 = light&#123;&#123;<span class="number">20</span>, <span class="number">20</span>, <span class="number">20</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line">    <span class="keyword">auto</span> l2 = light&#123;&#123;<span class="number">-20</span>, <span class="number">20</span>, <span class="number">0</span>&#125;, &#123;<span class="number">500</span>, <span class="number">500</span>, <span class="number">500</span>&#125;&#125;;</span><br><span class="line"></span><br><span class="line">    std::vector&lt;light&gt; lights = &#123;l1, l2&#125;;</span><br><span class="line">    Eigen::Vector3f amb_light_intensity&#123;<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>&#125;;</span><br><span class="line">    Eigen::Vector3f eye_pos&#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">10</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> p = <span class="number">150</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f color = payload.color; </span><br><span class="line">    Eigen::Vector3f point = payload.view_pos;</span><br><span class="line">    Eigen::Vector3f normal = payload.normal;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> kh = <span class="number">0.2</span>, kn = <span class="number">0.1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// næ˜¯åŸæ¥æ¨¡å‹ç©ºé—´çš„æ³•çº¿</span></span><br><span class="line">    Eigen::Vector3f n = normal;</span><br><span class="line">    <span class="type">float</span> x = n.<span class="built_in">x</span>(), y = n.<span class="built_in">y</span>(), z = n.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¡ç®—å¾—åˆ°æ³•çº¿ç©ºé—´çš„åŸºå‘é‡tå’Œb(æ³•çº¿ç©ºé—´ä¸­ï¼Œnä¸æ¨¡å‹ç©ºé—´ä¸€è‡´)</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">t</span><span class="params">(x*y / sqrt(x*x + z*z), sqrt(x*x + z*z), z*y / sqrt(x*x + z*z))</span></span>;</span><br><span class="line">    Eigen::Vector3f b = n.<span class="built_in">cross</span>(t);</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix3f TBN; <span class="comment">//TBNçŸ©é˜µ: å°†çº¹ç†åæ ‡å¯¹åº”åˆ°æ¨¡å‹ç©ºé—´ä¸­</span></span><br><span class="line">    TBN &lt;&lt;  t.<span class="built_in">x</span>(), b.<span class="built_in">x</span>(), n.<span class="built_in">x</span>(),</span><br><span class="line">            t.<span class="built_in">y</span>(), b.<span class="built_in">y</span>(), n.<span class="built_in">y</span>(),</span><br><span class="line">            t.<span class="built_in">z</span>(), b.<span class="built_in">z</span>(), n.<span class="built_in">z</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// çº¹ç†åæ ‡å’Œå¤§å°</span></span><br><span class="line">    <span class="type">float</span> u = payload.tex_coords.<span class="built_in">x</span>(), v = payload.tex_coords.<span class="built_in">y</span>();</span><br><span class="line">    <span class="type">float</span> w = payload.texture-&gt;width, h = payload.texture-&gt;height;</span><br><span class="line"></span><br><span class="line">    <span class="type">float</span> dU = kh * kn * (<span class="built_in">func_h</span>(u+<span class="number">1</span>/w, v) - <span class="built_in">func_h</span>(u,v));</span><br><span class="line">    <span class="type">float</span> dV = kh * kn * (<span class="built_in">func_h</span>(u, v+<span class="number">1</span>/h) - <span class="built_in">func_h</span>(u,v));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·å¾—åˆ‡çº¿ç©ºé—´ä¸­æ³•çº¿çš„åæ ‡</span></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">ln</span><span class="params">(-dU, -dV, <span class="number">1.0f</span>)</span></span>;</span><br><span class="line">    ln.<span class="built_in">normalize</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å°†å®ƒè½¬æ¢åˆ°æ¨¡å‹ç©ºé—´ä¸­</span></span><br><span class="line">    normal = (TBN * ln).<span class="built_in">normalized</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ”¹å˜ç›®æ ‡ç‚¹çš„ä½ç½®ï¼Œå°†ç›®æ ‡ç‚¹æ‹”é«˜</span></span><br><span class="line">    point = point + kn * n * (payload.texture-&gt;<span class="built_in">getColor</span>(u,v).<span class="built_in">norm</span>());</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f result_color = &#123;<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line">    Eigen::Vector3f ambient=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f diffuse=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    Eigen::Vector3f specular=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span>&amp; light : lights)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// æ¼«åå°„</span></span><br><span class="line">        <span class="type">float</span> r_squared = (light.position - point).<span class="built_in">squaredNorm</span>();</span><br><span class="line">        diffuse = kd.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * <span class="built_in">MAX</span>(<span class="number">0</span>, normal.<span class="built_in">dot</span>(((light.position - point).<span class="built_in">normalized</span>())));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é«˜å…‰åå°„</span></span><br><span class="line">        <span class="keyword">auto</span> h = ((light.position - point).<span class="built_in">normalized</span>() + (eye_pos - point).<span class="built_in">normalized</span>()).<span class="built_in">normalized</span>();</span><br><span class="line">        specular = ks.<span class="built_in">cwiseProduct</span>(light.intensity / r_squared) * std::<span class="built_in">pow</span>(std::<span class="built_in">max</span>(<span class="number">0.0f</span>, normal.<span class="built_in">dot</span>(h)), p); </span><br><span class="line">    </span><br><span class="line">        <span class="comment">// ç¯å¢ƒåå°„</span></span><br><span class="line">        ambient = ka.<span class="built_in">cwiseProduct</span>(amb_light_intensity);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å°†ä¸‰ç§å…‰ç›¸åŠ </span></span><br><span class="line">        result_color += ambient + diffuse + specular;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> result_color * <span class="number">255.f</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç»“æœï¼š</strong></p><p><img src="/images/Games101/homework/03/05.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/27/games101/HomeWork%203/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 2ï¼šTriangles and Z-bufferingï¼ˆå…‰æ …åŒ– å’Œ æŠ—é”¯é½¿ï¼‰</title>
      <link>http://example.com/2024/01/27/games101/HomeWork%202/</link>
      <guid>http://example.com/2024/01/27/games101/HomeWork%202/</guid>
      <pubDate>Sat, 27 Jan 2024 15:26:45 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-2ï¼šTriangles-and-Z-bufferingï¼ˆå…‰æ …åŒ–-å’Œ-æŠ—é”¯é½¿ï¼‰&quot;&gt;&lt;a href=&quot;#HomeWork-2ï¼šTriangles-and-Z-bufferingï¼ˆå…‰æ …åŒ–-å’Œ-æŠ—é”¯é½¿ï¼‰&quot; class=&quot;headerlink&quot; title</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-2ï¼šTriangles-and-Z-bufferingï¼ˆå…‰æ …åŒ–-å’Œ-æŠ—é”¯é½¿ï¼‰"><a href="#HomeWork-2ï¼šTriangles-and-Z-bufferingï¼ˆå…‰æ …åŒ–-å’Œ-æŠ—é”¯é½¿ï¼‰" class="headerlink" title="HomeWork 2ï¼šTriangles and Z-bufferingï¼ˆå…‰æ …åŒ– å’Œ æŠ—é”¯é½¿ï¼‰"></a>HomeWork 2ï¼šTriangles and Z-bufferingï¼ˆå…‰æ …åŒ– å’Œ æŠ—é”¯é½¿ï¼‰</h1><h2 id="ä»£ç "><a href="#ä»£ç " class="headerlink" title="ä»£ç "></a>ä»£ç </h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    è¿™ä¸ªé‡Œçš„ zNearï¼ŒzFar ç»™çš„åˆæ˜¯è´Ÿæ•°äº†...</span></span><br><span class="line"><span class="comment">    æ‰€ä»¥è¿™é‡Œæ˜¯ä¸ç”¨åè½¬çš„...</span></span><br><span class="line"><span class="comment">    ä¸ç„¶ç»“æœä¼šç›¸åï¼Œå¤§å®¶å¯ä»¥è¯•è¯•</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    </span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line">...</span><br><span class="line">    <span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ï¼ˆæˆ‘è¿™é‡Œç”¨çš„æ˜¯å‰ç§¯ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">insideTriangle</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y, <span class="type">const</span> Vector3f* _v)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¡¨ç¤ºå‰ç§¯åçš„æ–¹å‘ï¼Œ0 è¡¨ç¤ºè´Ÿï¼Œ1 è¡¨ç¤ºæ­£</span></span><br><span class="line">    <span class="type">int</span> flag = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// the current point</span></span><br><span class="line">        Eigen::Vector3f p0 = &#123;x, y, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="comment">// the 1st vertex</span></span><br><span class="line">        Eigen::Vector3f p1 = _v[i];</span><br><span class="line">        <span class="comment">// the 2nd vertex</span></span><br><span class="line">        Eigen::Vector3f p2 = _v[(i+<span class="number">1</span>)%<span class="number">3</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªå‘é‡ (p1-p0)</span></span><br><span class="line">        Eigen::Vector3f v1 = p1-p0;</span><br><span class="line">        <span class="comment">// ç¬¬äºŒä¸ªå‘é‡ (p1-p2)</span></span><br><span class="line">        Eigen::Vector3f v2 = p1-p2;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±‚ä¸€ä¸‹å‰ç§¯</span></span><br><span class="line">        <span class="type">float</span> cp = v1.<span class="built_in">cross</span>(v2).<span class="built_in">z</span>();</span><br><span class="line">        <span class="keyword">if</span>(cp == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> sign = cp &lt; <span class="number">0</span> ? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(flag == <span class="number">-1</span>) flag = sign;</span><br><span class="line">        <span class="keyword">if</span>(flag != sign) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¸‰è§’å½¢å…‰æ …åŒ–</span></span><br><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">rasterize_triangle</span>(<span class="type">const</span> Triangle&amp; t) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = t.<span class="built_in">toVector4</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> min_x = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_x = INT_MIN;</span><br><span class="line">    <span class="type">int</span> min_y = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_y = INT_MIN;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹ä¸‰è§’å½¢çš„åŒ…å›´ç›’</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> point : v) <span class="comment">//è·å–åŒ…å›´ç›’è¾¹ç•Œ</span></span><br><span class="line">    &#123;</span><br><span class="line">        min_x = <span class="built_in">min</span>(min_x, point[<span class="number">0</span>]);</span><br><span class="line">        max_x = <span class="built_in">max</span>(max_x, point[<span class="number">0</span>]);</span><br><span class="line">        min_y = <span class="built_in">min</span>(min_y, point[<span class="number">1</span>]);</span><br><span class="line">        max_y = <span class="built_in">max</span>(max_y, point[<span class="number">1</span>]);</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†åŒ…å›´ç›’é‡Œé¢çš„ç‚¹</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> y = min_y; y &lt;= max_y; y++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = min_x; x &lt;= max_x; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">insideTriangle</span>((<span class="type">float</span>)x+<span class="number">0.5</span>, (<span class="type">float</span>)y+<span class="number">0.5</span>, t.v))</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">// è·å–åƒç´ ç‚¹åœ¨ä¸‰è§’å½¢å†…çš„ â€œé‡å¿ƒåæ ‡çš„ç³»æ•°â€</span></span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = <span class="built_in">computeBarycentric2D</span>(x+<span class="number">0.5</span>, y+<span class="number">0.5</span>, t.v);</span><br><span class="line">                </span><br><span class="line">               <span class="comment">// è®¡ç®—è¿™ä¸ªåƒç´ ç‚¹çš„æ·±åº¦</span></span><br><span class="line">                <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma / v[<span class="number">2</span>].<span class="built_in">w</span>());</span><br><span class="line">                <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].<span class="built_in">z</span>() / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta * v[<span class="number">1</span>].<span class="built_in">z</span>() / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma * v[<span class="number">2</span>].<span class="built_in">z</span>() / v[<span class="number">2</span>].<span class="built_in">w</span>();</span><br><span class="line">                z_interpolated *= w_reciprocal;</span><br><span class="line"></span><br><span class="line">                <span class="comment">// åˆ¤æ–­å½“å‰zå€¼æ˜¯å¦å°äºåŸæ¥zè¡¨æ­¤ä½ç½®çš„zå€¼</span></span><br><span class="line">                <span class="keyword">if</span> (z_interpolated &lt; depth_buf[<span class="built_in">get_index</span>(x, y)]) </span><br><span class="line">                &#123;</span><br><span class="line">                    Eigen::Vector3f p = &#123; (<span class="type">float</span>)x,(<span class="type">float</span>)y, z_interpolated &#125;; <span class="comment">// å½“å‰åæ ‡</span></span><br><span class="line">                    <span class="built_in">set_pixel</span>(p, t.<span class="built_in">getColor</span>()); </span><br><span class="line">                    depth_buf[<span class="built_in">get_index</span>(x, y)] = z_interpolated; <span class="comment">// æ›´æ–°zå€¼</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æé«˜çš„æŠ—é”¯é½¿å¯ä»¥çœ‹è¿™é‡Œï¼š</strong></p><p><a href="https://zhuanlan.zhihu.com/p/454001952">Games101ï½œä½œä¸š2 + å…‰æ …åŒ– + SSAA vs MSAA + é»‘è¾¹é—®é¢˜ - çŸ¥ä¹ (zhihu.com)</a></p><p><strong>åˆ†æçš„å¤ªæ£’äº†ï¼</strong></p><h2 id="ç»“æœ"><a href="#ç»“æœ" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/images/Games101/homework/02/01.png"></p><h2 id="è¡¥ä¸€ä¸‹æé«˜-å˜»å˜»å˜»"><a href="#è¡¥ä¸€ä¸‹æé«˜-å˜»å˜»å˜»" class="headerlink" title="è¡¥ä¸€ä¸‹æé«˜ å˜»å˜»å˜»"></a>è¡¥ä¸€ä¸‹æé«˜ å˜»å˜»å˜»</h2><p><strong>rasterizer.hpp æ·»åŠ </strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;Eigen::Vector3f&gt; color_list;</span><br></pre></td></tr></table></figure><p><strong>rasterizer.cpp</strong></p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ¤æ–­ç‚¹æ˜¯å¦åœ¨ä¸‰è§’å½¢å†…ï¼ˆæˆ‘è¿™é‡Œç”¨çš„æ˜¯å‰ç§¯ï¼‰</span></span><br><span class="line"><span class="function"><span class="type">static</span> <span class="type">bool</span> <span class="title">insideTriangle</span><span class="params">(<span class="type">float</span> x, <span class="type">float</span> y, <span class="type">const</span> Vector3f* _v)</span></span></span><br><span class="line"><span class="function"></span>&#123;   </span><br><span class="line">    <span class="comment">// è¿™ä¸ªè¡¨ç¤ºå‰ç§¯åçš„æ–¹å‘ï¼Œ0 è¡¨ç¤ºè´Ÿï¼Œ1 è¡¨ç¤ºæ­£</span></span><br><span class="line">    <span class="type">int</span> flag = <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) </span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// the current point</span></span><br><span class="line">        Eigen::Vector3f p0 = &#123;x, y, <span class="number">0</span>&#125;;</span><br><span class="line">        <span class="comment">// the 1st vertex</span></span><br><span class="line">        Eigen::Vector3f p1 = _v[i];</span><br><span class="line">        <span class="comment">// the 2nd vertex</span></span><br><span class="line">        Eigen::Vector3f p2 = _v[(i+<span class="number">1</span>)%<span class="number">3</span>];</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// ç¬¬ä¸€ä¸ªå‘é‡ (p1-p0)</span></span><br><span class="line">        Eigen::Vector3f v1 = p1-p0;</span><br><span class="line">        <span class="comment">// ç¬¬äºŒä¸ªå‘é‡ (p1-p2)</span></span><br><span class="line">        Eigen::Vector3f v2 = p1-p2;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ±‚ä¸€ä¸‹å‰ç§¯         float cp = v1.cross(v2).z();</span></span><br><span class="line">        <span class="keyword">if</span>(cp == <span class="number">0</span>) <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> sign = cp &lt; <span class="number">0</span> ? <span class="number">0</span>: <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span>(flag == <span class="number">-1</span>) flag = sign;</span><br><span class="line">        <span class="keyword">if</span>(flag != sign) <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* ------------------------------------------------------------------------------- */</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å››ä¸ªé‡‡æ ·ç‚¹ float dx[] = &#123;0.25, 0.25, 0.75, 0.75&#125;;</span></span><br><span class="line"><span class="type">float</span> dy[] = &#123;<span class="number">0.25</span>, <span class="number">0.75</span>, <span class="number">0.25</span>, <span class="number">0.75</span>&#125;;</span><br><span class="line"><span class="comment">// ä¸‰è§’å½¢å…‰æ …åŒ–</span></span><br><span class="line"><span class="type">void</span> rst::rasterizer::<span class="built_in">rasterize_triangle</span>(<span class="type">const</span> Triangle&amp; t) </span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">auto</span> v = t.<span class="built_in">toVector4</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">int</span> min_x = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_x = INT_MIN;</span><br><span class="line">    <span class="type">int</span> min_y = INT_MAX;</span><br><span class="line">    <span class="type">int</span> max_y = INT_MIN;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹ä¸‰è§’å½¢çš„åŒ…å›´ç›’</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">auto</span> point : v) <span class="comment">//è·å–åŒ…å›´ç›’è¾¹ç•Œ     &#123;</span></span><br><span class="line">        min_x = <span class="built_in">min</span>((<span class="type">float</span>)min_x, point[<span class="number">0</span>]);</span><br><span class="line">        max_x = <span class="built_in">max</span>((<span class="type">float</span>)max_x, point[<span class="number">0</span>]);</span><br><span class="line">        min_y = <span class="built_in">min</span>((<span class="type">float</span>)min_y, point[<span class="number">1</span>]);</span><br><span class="line">        max_y = <span class="built_in">max</span>((<span class="type">float</span>)max_y, point[<span class="number">1</span>]);</span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    <span class="comment">// éå†åŒ…å›´ç›’é‡Œé¢çš„ç‚¹     for (int y = min_y; y &lt; max_y; y++)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x = min_x; x &lt; max_x; x++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// å–å››ä¸ªç‚¹(MSAA)</span></span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;<span class="number">4</span>;i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="type">float</span> xx = (<span class="type">double</span>)x + dx[i];</span><br><span class="line">                <span class="type">float</span> yy = (<span class="type">double</span>)y + dy[i];</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> (<span class="built_in">insideTriangle</span>(xx, yy, t.v))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// è·å–åƒç´ ç‚¹åœ¨ä¸‰è§’å½¢å†…çš„ â€œé‡å¿ƒåæ ‡çš„ç³»æ•°â€</span></span><br><span class="line">                <span class="keyword">auto</span>[alpha, beta, gamma] = <span class="built_in">computeBarycentric2D</span>(x+<span class="number">0.5</span>, y+<span class="number">0.5</span>, t.v);</span><br><span class="line">                </span><br><span class="line">               <span class="comment">// è®¡ç®—è¿™ä¸ªåƒç´ ç‚¹çš„æ·±åº¦</span></span><br><span class="line">                    <span class="type">float</span> w_reciprocal = <span class="number">1.0</span>/(alpha / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma / v[<span class="number">2</span>].<span class="built_in">w</span>());</span><br><span class="line">                    <span class="type">float</span> z_interpolated = alpha * v[<span class="number">0</span>].<span class="built_in">z</span>() / v[<span class="number">0</span>].<span class="built_in">w</span>() + beta * v[<span class="number">1</span>].<span class="built_in">z</span>() / v[<span class="number">1</span>].<span class="built_in">w</span>() + gamma * v[<span class="number">2</span>].<span class="built_in">z</span>() / v[<span class="number">2</span>].<span class="built_in">w</span>();</span><br><span class="line">                    z_interpolated *= w_reciprocal;</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// åˆ¤æ–­å½“å‰zå€¼æ˜¯å¦å°äºåŸæ¥zè¡¨æ­¤ä½ç½®çš„zå€¼                     if (z_interpolated &lt; depth_buf[get_index(x, y)*4+i]) </span></span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// æ›´æ–°è¿™ä¸ªé‡‡æ ·ç‚¹                         depth_buf[get_index(x, y)*4+i] = z_interpolated;</span></span><br><span class="line">                        color_list[<span class="built_in">get_index</span>(x, y)*<span class="number">4</span>+i] = t.<span class="built_in">getColor</span>();</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// é‡æ–°ç®—ä¸€ä¸‹è¿™ä¸ªåƒç´ ç‚¹çš„é¢œè‰²(å–å¹³å‡)</span></span><br><span class="line">                        <span class="function">Eigen::Vector3f <span class="title">new_color</span><span class="params">(<span class="number">0.0f</span>, <span class="number">0.0f</span>, <span class="number">0.0f</span>)</span></span>;</span><br><span class="line">                        <span class="keyword">for</span>(<span class="type">int</span> j=<span class="number">0</span>;j&lt;<span class="number">4</span>;j++) </span><br><span class="line">                            new_color += color_list[<span class="built_in">get_index</span>(x, y)*<span class="number">4</span>+j];</span><br><span class="line">                        new_color /= <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">                        <span class="comment">// æ›´æ–°å½“å‰åƒç´ çš„å€¼                         Eigen::Vector3f p = &#123; (float)x,(float)y, z_interpolated &#125;;</span></span><br><span class="line">                        <span class="built_in">set_pixel</span>(p, new_color);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“æœ-1"><a href="#ç»“æœ-1" class="headerlink" title="ç»“æœ"></a>ç»“æœ</h2><p><img src="/images/Games101/homework/02/02.png"></p><p><strong>ç»“æœå¯¹æ¯”ï¼š</strong></p><p><img src="/images/Games101/homework/02/03.png"></p><p><img src="/images/Games101/homework/02/04.png"></p><p><strong>å¤ªç¥å¥‡å•¦ï¼</strong></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/27/games101/HomeWork%202/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>ã€Games 101ã€‘HomeWork 1ï¼šæ—‹è½¬ä¸æŠ•å½±</title>
      <link>http://example.com/2024/01/27/games101/HomeWork%201/</link>
      <guid>http://example.com/2024/01/27/games101/HomeWork%201/</guid>
      <pubDate>Sat, 27 Jan 2024 15:25:29 GMT</pubDate>
      
        
        
      <description>&lt;h1 id=&quot;HomeWork-1ï¼šæ—‹è½¬ä¸æŠ•å½±&quot;&gt;&lt;a href=&quot;#HomeWork-1ï¼šæ—‹è½¬ä¸æŠ•å½±&quot; class=&quot;headerlink&quot; title=&quot;HomeWork 1ï¼šæ—‹è½¬ä¸æŠ•å½±&quot;&gt;&lt;/a&gt;HomeWork 1ï¼šæ—‹è½¬ä¸æŠ•å½±&lt;/h1&gt;&lt;h2 id=&quot;ä»£ç ï¼š&quot;&gt;&lt;a h</description>
        
      
      
      
      <content:encoded><![CDATA[<h1 id="HomeWork-1ï¼šæ—‹è½¬ä¸æŠ•å½±"><a href="#HomeWork-1ï¼šæ—‹è½¬ä¸æŠ•å½±" class="headerlink" title="HomeWork 1ï¼šæ—‹è½¬ä¸æŠ•å½±"></a>HomeWork 1ï¼šæ—‹è½¬ä¸æŠ•å½±</h1><h2 id="ä»£ç ï¼š"><a href="#ä»£ç ï¼š" class="headerlink" title="ä»£ç ï¼š"></a>ä»£ç ï¼š</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ¨¡å‹å˜æ¢ï¼š</span></span><br><span class="line"><span class="comment">        é€ä¸ªå…ƒç´ åœ°æ„å»ºæ¨¡å‹å˜æ¢çŸ©é˜µå¹¶è¿”å›è¯¥çŸ©é˜µã€‚</span></span><br><span class="line"><span class="comment">        åœ¨æ­¤å‡½æ•°ä¸­ï¼Œä½ åªéœ€è¦å®ç°ä¸‰ç»´ä¸­ç»• z è½´æ—‹è½¬çš„å˜æ¢çŸ©é˜µï¼Œè€Œä¸ç”¨å¤„ç†å¹³ç§»ä¸ç¼©æ”¾ã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åˆ†æï¼š</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªæ¯”è¾ƒç®€å•ï¼Œæç¤ºä¹Ÿè¯´äº†æˆ‘ä»¬åªéœ€è¦ç»•ç€ z è½´æ—‹è½¬å°±è¡Œï¼›</span></span><br><span class="line"><span class="comment">        å›é¡¾ä¸€ä¸‹å…¬å¼ï¼šhttp://fjbq-blog.top/2023/12/30/GAMES%20101%20%E9%9A%8F%E7%AC%94/</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_model_matrix</span><span class="params">(<span class="type">float</span> rotation_angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// è½¬æ¢ä¸ºå¼§åº¦åˆ¶</span></span><br><span class="line">    <span class="type">float</span> rotation_angle_rad = rotation_angle / <span class="number">180.0</span> * MY_PI;    </span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ª æ¨¡å‹å˜æ¢çŸ©é˜µï¼Œé»˜è®¤åˆå§‹åŒ–çŸ©é˜µä¸ºå•ä½çŸ©é˜µ</span></span><br><span class="line">    Eigen::Matrix4f model = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line"></span><br><span class="line">    model &lt;&lt; <span class="built_in">cos</span>(rotation_angle_rad), -<span class="built_in">sin</span>(rotation_angle_rad), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">             <span class="built_in">sin</span>(rotation_angle_rad), <span class="built_in">cos</span>(rotation_angle_rad), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    //ç»•xè½´</span></span><br><span class="line"><span class="comment">    model &lt;&lt; 1, 0, 0, 0,</span></span><br><span class="line"><span class="comment">             0, cos(angle), -sin(angle), 0,</span></span><br><span class="line"><span class="comment">             0, sin(angle), cos(angle), 0,</span></span><br><span class="line"><span class="comment">             0, 0, 0, 1;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    //ç»•yè½´ï¼ˆæ³¨æ„æ˜¯åçš„å“¦ï¼‰</span></span><br><span class="line"><span class="comment">    model &lt;&lt; cos(angle), 0, sin(angle), 0,</span></span><br><span class="line"><span class="comment">             0, 1, 0, 0,</span></span><br><span class="line"><span class="comment">             -sin(angle), 0, cos(angle), 0,</span></span><br><span class="line"><span class="comment">             0, 0, 0, 1;</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    æŠ•å½±å˜æ¢ï¼š</span></span><br><span class="line"><span class="comment">        ä½¿ç”¨ç»™å®šçš„å‚æ•°é€ä¸ªå…ƒç´ åœ°æ„å»ºé€è§†æŠ•å½±çŸ©é˜µå¹¶è¿”å›è¯¥çŸ©é˜µã€‚</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">    åˆ†æï¼š</span></span><br><span class="line"><span class="comment">        è¿™ä¸ªæ„Ÿè§‰å°±æ¯”è¾ƒå¤æ‚ä¸€ç‚¹äº†...</span></span><br><span class="line"><span class="comment">        é¦–å…ˆæ ¹æ®å‰é¢çš„å­¦ä¹ ï¼Œæˆ‘ä»¬çŸ¥é“ é€è§†æŠ•å½±çŸ©é˜µ = æ­£äº¤æŠ•å½±çŸ©é˜µ * é€è§†å‹ç¼©çŸ©é˜µï¼ˆæ³¨æ„é¡ºåºå“¦ï¼‰</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">        å…¶ä¸­è¿™ä¸ª æ­£äº¤æŠ•å½±çŸ©é˜µ é‡Œé¢ç”¨åˆ°çš„å‚æ•°éœ€è¦æˆ‘ä»¬å»æ±‚ä¸€ä¸‹çš„...</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_projection_matrix</span><span class="params">(<span class="type">float</span> eye_fov, <span class="type">float</span> aspect_ratio, <span class="type">float</span> zNear, <span class="type">float</span> zFar)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    æ€ä¹ˆæ„Ÿè§‰çŸ¥ä¹å¤§ä½¬çš„ä»£ç æ€ªæ€ªçš„ï¼›</span></span><br><span class="line"><span class="comment">    è¿™ä¸ª zNearï¼ŒzFar ç»™çš„æ˜¯æ­£æ•°ï¼›</span></span><br><span class="line"><span class="comment">    ä¸‹é¢è®¡ç®—çš„éƒ½æ˜¯ç”¨çš„è´Ÿæ•°ï¼Œå…ˆè½¬æ¢ä¸€ä¸‹ï¼Ÿ</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    zNear = -zNear;</span><br><span class="line">    zFar = -zFar;</span><br><span class="line">    </span><br><span class="line">    Eigen::Matrix4f projection = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€è§†æŠ•å½±å‹ç¼©çŸ©é˜µ</span></span><br><span class="line">    Eigen::Matrix4f M_persp;</span><br><span class="line">    M_persp &lt;&lt;  zNear, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, zNear, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, zNear + zFar, -zNear*zFar,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ±‚ä¸€ä¸‹æ­£äº¤æŠ•å½±çŸ©é˜µè¦ç”¨åˆ°çš„å‚æ•°</span></span><br><span class="line">    <span class="type">float</span> alpha = <span class="number">0.5</span> * (eye_fov / <span class="number">180.0f</span> * MY_PI);     <span class="comment">// è§†é‡è§’åº¦çš„ä¸€åŠ</span></span><br><span class="line">    <span class="type">float</span> yTop = -zNear * std::<span class="built_in">tan</span>(alpha);              <span class="comment">// å› ä¸ºè¿™é‡Œçš„zç»™çš„æ˜¯è´Ÿæ•°ï¼Œæ‰€ä»¥åŠ è´Ÿå·ä¹‹åå†è½¬æ¢</span></span><br><span class="line">    <span class="type">float</span> yBottom = -yTop;</span><br><span class="line">    <span class="type">float</span> xRight = yTop * aspect_ratio;                 <span class="comment">// aspect_ratio æ˜¯ xy çš„æ¯”ä¾‹</span></span><br><span class="line">    <span class="type">float</span> xLeft = -xRight;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f M_trans;</span><br><span class="line">    M_trans &lt;&lt;  <span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, -(xLeft + xRight) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>, -(yTop + yBottom) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>, -(zNear + zFar) / <span class="number">2</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    Eigen::Matrix4f M_ortho;</span><br><span class="line">    M_ortho &lt;&lt;  <span class="number">2</span> / (xRight - xLeft), <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">2</span> / (yTop - yBottom), <span class="number">0</span>, <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span> / (zNear - zFar), <span class="number">0</span>,</span><br><span class="line">                <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå°±æ˜¯ æ­£äº¤æŠ•å½±çŸ©é˜µ</span></span><br><span class="line">    M_ortho = M_ortho * M_trans;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é€è§†æŠ•å½±çŸ©é˜µ = æ­£äº¤æŠ•å½±çŸ©é˜µ * é€è§†å‹ç¼©çŸ©é˜µï¼ˆæ³¨æ„é¡ºåºå“¦ï¼‰</span></span><br><span class="line">    projection = M_ortho * M_persp * projection;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> projection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">    è¿›é˜¶ æ¨¡å‹å˜æ¢çŸ©é˜µï¼šç»•ä»»æ„è½´æ—‹è½¬</span></span><br><span class="line"><span class="comment">    å‚è€ƒçš„æ˜¯çŸ¥ä¹å¤§ä½¬çš„ï¼šhttps://zhuanlan.zhihu.com/p/448904350</span></span><br><span class="line"><span class="comment">    ç”¨ n è¡¨ç¤ºä¸€ä¸ªè¿‡åŸç‚¹çš„å‘é‡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">Eigen::Matrix4f <span class="title">get_random_model_matrix</span><span class="params">(Eigen::Vector3f n,<span class="type">float</span> rotation_angle)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    Eigen::Matrix4f model = Eigen::Matrix4f::<span class="built_in">Identity</span>();</span><br><span class="line">    Eigen::Matrix3f I = Eigen::Matrix3f::<span class="built_in">Identity</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="type">float</span> angle = rotation_angle / <span class="number">180.0f</span> * MY_PI ;</span><br><span class="line">    <span class="type">float</span> nx = n[<span class="number">0</span>];</span><br><span class="line">    <span class="type">float</span> ny = n[<span class="number">1</span>];</span><br><span class="line">    <span class="type">float</span> nz = n[<span class="number">2</span>];</span><br><span class="line">    </span><br><span class="line">    Eigen::Matrix3f N;</span><br><span class="line">    N &lt;&lt; <span class="number">0</span>, -nz, ny,</span><br><span class="line">         nz, <span class="number">0</span>, -nx,</span><br><span class="line">         -ny, nx, <span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// å…¬å¼</span></span><br><span class="line">    Eigen::Matrix3f R = std::<span class="built_in">cos</span>(angle) * I + (<span class="number">1</span> - std::<span class="built_in">cos</span>(angle)) * n * n.<span class="built_in">transpose</span>() + std::<span class="built_in">sin</span>(angle) * N;</span><br><span class="line">    </span><br><span class="line">    model &lt;&lt; <span class="built_in">R</span>(<span class="number">0</span>, <span class="number">0</span>), <span class="built_in">R</span>(<span class="number">0</span>, <span class="number">1</span>), <span class="built_in">R</span>(<span class="number">0</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">             <span class="built_in">R</span>(<span class="number">1</span>, <span class="number">0</span>), <span class="built_in">R</span>(<span class="number">1</span>, <span class="number">1</span>), <span class="built_in">R</span>(<span class="number">1</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">             <span class="built_in">R</span>(<span class="number">2</span>, <span class="number">0</span>), <span class="built_in">R</span>(<span class="number">2</span>, <span class="number">1</span>), <span class="built_in">R</span>(<span class="number">2</span>, <span class="number">2</span>), <span class="number">0</span>,</span><br><span class="line">             <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> model;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="ç»“æœï¼š"><a href="#ç»“æœï¼š" class="headerlink" title="ç»“æœï¼š"></a>ç»“æœï¼š</h2><p><img src="/images/Games101/homework/01/01.png"></p><p><img src="/images/Games101/homework/01/02.png"></p>]]></content:encoded>
      
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/categories/Games-%E7%B3%BB%E5%88%97/Games-101/">Games 101</category>
      
      
      <category domain="http://example.com/tags/Games-%E7%B3%BB%E5%88%97/">Games ç³»åˆ—</category>
      
      <category domain="http://example.com/tags/Games-101/">Games 101</category>
      
      
      <comments>http://example.com/2024/01/27/games101/HomeWork%201/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
